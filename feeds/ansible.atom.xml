<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Le Free de la Passion - ansible</title><link href="https://foxmask.net/" rel="alternate"></link><link href="https://foxmask.net/feeds/ansible.atom.xml" rel="self"></link><id>https://foxmask.net/</id><updated>2016-02-02T01:00:00+01:00</updated><subtitle>La passion de la liberté</subtitle><entry><title>Revue Technique de la semaine du 02/02/2016</title><link href="https://foxmask.net/post/2016/02/02/revue-technique-de-la-semaine-du-02022016/" rel="alternate"></link><published>2016-02-02T01:00:00+01:00</published><updated>2016-02-02T01:00:00+01:00</updated><author><name>foxmask</name></author><id>tag:foxmask.net,2016-02-02:/post/2016/02/02/revue-technique-de-la-semaine-du-02022016/</id><summary type="html">&lt;p&gt;Ca vous manquait aussi un billet du renard masqué hein ?
Bon qu'est-ce que je vais bien pouvoir vous racontrer ? &lt;/p&gt;
&lt;h3&gt;Evernote de mieux en pire ?&lt;/h3&gt;
&lt;p&gt;Je résumerai bien ce qui arrive a Evernote par "Qui trop étreint, mal embrasse" tant ce qui se passe le reflète.
L'an passé on apprenait qu'Evernote …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Ca vous manquait aussi un billet du renard masqué hein ?
Bon qu'est-ce que je vais bien pouvoir vous racontrer ? &lt;/p&gt;
&lt;h3&gt;Evernote de mieux en pire ?&lt;/h3&gt;
&lt;p&gt;Je résumerai bien ce qui arrive a Evernote par "Qui trop étreint, mal embrasse" tant ce qui se passe le reflète.
L'an passé on apprenait qu'Evernote se séparait d'une partie de ses equipes d'ingénierie, après que certains associés fondateurs aient tirés leur révérence, au point qu'on evoquait sa fin, ce qui m'a du coup fait prendre conscience, comme pour google, "nom di diou si ca ferme demain que fais je de mon contenu?", ou "Le syndrôme des services gratos Google qui vous font perdre vos données à vous même rien à vous".&lt;/p&gt;
&lt;p&gt;Pour ma part j'ai rapidement repris le dessus puisque je peux facilement renvoyer tout ce que j'ai chez, eux ailleurs, via mon projet &lt;a href="http://blog.trigger-happy.eu"&gt;TriggerHappy&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Mais revenons à nos moutons, après ce premier évènement, suit un second depuis hier, Evernote annonce cesser son activité de &lt;a href="http://www.theverge.com/2016/2/1/10890562/evernote-market-shut-down-moleskine-notebook-2016"&gt;vente de produits hype&lt;/a&gt; et quand même cher pour ce que c'est. Donc fini les carnets moleskine, portefeuille et scanner, qui ne seront plus vendus que par leur partenaire. Evernote se recentrant (enfin?) sur le software.&lt;/p&gt;
&lt;p&gt;Ce qui m'a toujours paru bizarre c'est leur blog où il tente de "louer", via des personnes exterieures à l'entreprise, la reussite de l'utilisation de l'outil, qui leur a changé la vie, qui les a rendu plus productifs etc. Comme s'ils avaient besoins de témoignages pour s'en convaincre eux mêmes. Ca me fait trop penser aux vieilles "pub témoignages" moisies "Weight Watchers" où pour vous convaincre, il faut vous le dire...&lt;/p&gt;
&lt;p&gt;Pour ma part j'adore l'outil qui, techniquement, est incontournable (le moteur de recherche offline + l'OCR notamment + le plugin firefox de capture d'article) mais la comm marketing autour est une misère.&lt;/p&gt;
&lt;p&gt;Donc pour l'heure, tant que le bateau ne chavire pas, je ne bougerai rien, sinon j'irai m'oriente vers une alternative libre déjà existante mais pour l'heure sans API permettant d'ajouter des données autrement que manuellement. Celle ci se nommera &lt;a href="https://github.com/twostairs/paperwork"&gt;paperwork&lt;/a&gt; ou &lt;a href="https://github.com/Laverna/laverna"&gt;laverna&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;Django&lt;/h3&gt;
&lt;h4&gt;1.9.2 security fix and 1.8.9 bug fix&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://www.djangoproject.com/weblog/2016/feb/01/releases-192-and-189/"&gt;A vos mises à jour&lt;/a&gt; si vous êtes sur la 1.9.x !
Pour la 1.8.9 rien à craindre, il s'agit que d'une release concernant peu de corrections de bugs.&lt;/p&gt;
&lt;h4&gt;Extensions or not to be&lt;/h4&gt;
&lt;p&gt;Il y a quelques jours j'évoquais un besoin sur les forms django (je ne sais plus lequel :P) avec &lt;a href="https://twitter.com/spoutnik"&gt;SpoutBe&lt;/a&gt; qui me disait que &lt;a href="https://github.com/maraujop/django-crispy-forms/"&gt;django crispy&lt;/a&gt; répondait à mon besoin. Mais je lui avais répondu que j'étais très réticent à utiliser des "projets satellites" parce que le jour où plus maintenus, le code produit (n')évolue (plus que) difficilement. Donc tant que c'est pas "core" je n'y toucherai pas. Il n'y a que les cas où des projets satellites "naissent" du core que je les emploie, comme par exemple &lt;a href="https://pypi.python.org/pypi/django-formwizard"&gt;django-formwizard&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Et vous, comment gérez vous l'ajout de fonctionnalités offertes par de tels projets pour Django ? Vous fiez vous à la "vivacité" du projet pour le choisir et vous dire que c'est un gage d'évolution ?&lt;/p&gt;
&lt;h3&gt;Meetup - c'est reparti !&lt;/h3&gt;
&lt;p&gt;Des meetup (DevOps, Paris.py) ont repris mais j'ai pas l'envie là tout de suite, pourtant j'ai l'occasion d'y aller en bonne compagnie, mais non là non, j'ai encore un coup de "mood" là , ca attendra !&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://www.meetup.com/fr-FR/Paris-Devops-Meetup/"&gt;Paris DevOps, aujourd'hui&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.meetup.com/Paris-py-Python-Django-friends/"&gt;Paris.Py, le 4 février&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Arround the world&lt;/h3&gt;
&lt;p&gt;Quelques bons billets à se mettre sous la dent :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://sametmax.com/evolution-de-python/"&gt;Evolution de Python&lt;/a&gt; par Sam et Max&lt;/li&gt;
&lt;li&gt;&lt;a href="http://anarc.at/blog/2016-01-31-free-software-activities-january-2016/"&gt;Free Software activities&lt;/a&gt; par Anarc&lt;/li&gt;
&lt;li&gt;&lt;a href="http://sametmax.com/nouvelle-release-de-crossbar-historique-des-events-et-crypto/"&gt;News de Crossbar&lt;/a&gt; par Sam et Max&lt;/li&gt;
&lt;li&gt;&lt;a href="http://feedproxy.google.com/~r/Pycharm/~3/YWRWdinNGw4/"&gt;PyCharm 5.0.4&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://pyfound.blogspot.fr/2016/01/postscript-to-warehouse-post.html"&gt;Le Pypi nouveau est sur les rails&lt;/a&gt; par la PSF&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;A Tester / A Lire&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://www.ansible.com/blog/ansible-2.0-launch"&gt;Ansible 2&lt;/a&gt;, à tester avant de switcher de 1.9, car ca pète pas mal de choses qui focntionnaient avant ou passent en dépréciées comme les inclusions de playbook avec un tag ... ca ca me reste en travers ...&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ceci n'est plus possible :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;   include: /path/to/foo/bar tag=foobar&lt;/span&gt;
&lt;span class="err"&gt;   include: /path/to/bar/foo tag=barfoo&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;du coup dans un main.yml, je ne peux plus conditionner l'inclusion (et donc l'execution de ce qui est inclus), merci !&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/gabrielhora/github_reviewer"&gt;Github Reviewer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://makina-corpus.com/blog/metier/2016/bien-demarrer-avec-django-rest-framework-personnalisation-des-routeurs-partie-5"&gt;bien démarrer DRF - Partie 5&lt;/a&gt; par Makina Corpus. ici j'ai pris le feuilleton en chemin, alors j'ai raccroché les vagons en m'envoyant les 4 premières parties ;)&lt;/li&gt;
&lt;li&gt;&lt;a href="http://mashable.com/2016/01/12/internet-explorer-8-9-10-dead/"&gt;IE 8,9,10, de l'histoire ancienne ?&lt;/a&gt; j'aime quand c'est microsoft qui le dit :) &lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.v3.co.uk/v3-uk/news/2443810/oracle-signals-the-end-of-java-applet-support-for-browsers"&gt;Oracle met à mort le support de la java applet dans les browsers&lt;/a&gt;. Les boites qui sont encore avec du IE &amp;lt; 10 et avec des applet java (au pif Oracle Forms) ont du mouron à se faire ...&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;J'en fout pas une&lt;/h3&gt;
&lt;p&gt;Depuis quelques semaines je commit que dalle sur TriggerHappy, je "papillone", je teste des trucs, je regarde des nouveaux langages, je glande, je joue, je procrastine, je fais de la bouffe (&lt;a href="http://www.recettes-bretonnes.fr/gateaux-bretons/quatre-quarts-pommes.html"&gt;genre&lt;/a&gt;), la vie quoi ...&lt;/p&gt;</content><category term="Techno"></category><category term="Django"></category><category term="python"></category><category term="devops"></category><category term="ansible"></category><category term="meetup"></category><category term="pycharm"></category></entry><entry><title>Shoot an Arrow with Ansible in the TriggerHappy target</title><link href="https://foxmask.net/post/2015/08/24/shoot-an-arrow-with-ansible-in-the-triggerhappy-target/" rel="alternate"></link><published>2015-08-24T10:57:00+02:00</published><updated>2015-08-24T10:57:00+02:00</updated><author><name>foxmask</name></author><id>tag:foxmask.net,2015-08-24:/post/2015/08/24/shoot-an-arrow-with-ansible-in-the-triggerhappy-target/</id><summary type="html">&lt;p&gt;Create a module for participating to TriggerHappy is now so simple that
I cant imagine to make a new one without this new little module named
"Trigger Happy Ansible"&lt;/p&gt;
&lt;p&gt;What does it do ?&lt;/p&gt;
&lt;p&gt;Well, as anyone can imagine, when you start a django project you enter,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;python manage.py startproject …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Create a module for participating to TriggerHappy is now so simple that
I cant imagine to make a new one without this new little module named
"Trigger Happy Ansible"&lt;/p&gt;
&lt;p&gt;What does it do ?&lt;/p&gt;
&lt;p&gt;Well, as anyone can imagine, when you start a django project you enter,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;python manage.py startproject 
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;when you start a new app you enter :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;python manage.py startapp
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;thus you will have a new empty module with a lot a "empty" files.&lt;/p&gt;
&lt;p&gt;To speed up the creation of a Trigger Happy module, first I made a
simple module
&lt;a href="https://github.com/foxmask/django-th-dummy"&gt;django-th-dummy&lt;/a&gt; that
provides a module ready to use , but that need to be customized to be
used.&lt;/p&gt;
&lt;p&gt;So I went a little far away and now you can just enter&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ansible-playbook -i hosts site.yml
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;and that's all !&lt;/p&gt;
&lt;p&gt;a new TriggerHappy module is ready to be installed in the middle of all
the others ones.&lt;/p&gt;
&lt;p&gt;Under the hood, what has been done ?&lt;/p&gt;
&lt;p&gt;You need to install ansible, then setup the site.yml file to change all
the variables that fit your needs and once the playbook is played, a new
folder will be created with everything needed by TriggerHappy&lt;/p&gt;
&lt;p&gt;Here is the
&lt;a href="https://github.com/foxmask/django-th-ansible/blob/master/site.yml"&gt;site.yml&lt;/a&gt;
file.&lt;/p&gt;
&lt;p&gt;The lines to be changed are those ones :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  &lt;span class="nt"&gt;vars&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="c1"&gt;# to directory tree and class/module/name purpose&lt;/span&gt;
    &lt;span class="nt"&gt;module_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;johndoe&lt;/span&gt;
    &lt;span class="nt"&gt;service_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;johndoe&lt;/span&gt;
    &lt;span class="nt"&gt;class_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Johndoe&lt;/span&gt;

    &lt;span class="c1"&gt;# for setup.py purpose&lt;/span&gt;
    &lt;span class="nt"&gt;author&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;John Doe&lt;/span&gt;
    &lt;span class="nt"&gt;author_email&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;john@doe.com&lt;/span&gt;
    &lt;span class="nt"&gt;description&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;this is a module that is fun&lt;/span&gt;
    &lt;span class="nt"&gt;details&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;when fun is higher than anything&lt;/span&gt;
    &lt;span class="nt"&gt;url&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;https://github.com/foxmask/django-th-johndoe&lt;/span&gt;
    &lt;span class="nt"&gt;download_url&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;https://github.com/foxmask/django-th-johndoe/archive/trigger-happy-johndoe-&lt;/span&gt;

    &lt;span class="c1"&gt;# for dependencies purpose&lt;/span&gt;
    &lt;span class="nt"&gt;external_api&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;foobar&lt;/span&gt;
    &lt;span class="nt"&gt;external_api_class&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Foobar&lt;/span&gt;
    &lt;span class="nt"&gt;external_api_version&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;1.2.3&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;as you can see, I separated variables by usage domain&lt;/p&gt;
&lt;p&gt;And here is the output of the running ansible playbook&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ansible-playbook -i hosts site.yml

    PLAY &lt;span class="o"&gt;[&lt;/span&gt;home-sweet-home&lt;span class="o"&gt;]&lt;/span&gt; ******************************************************** 

    GATHERING FACTS *************************************************************** 
    ok: &lt;span class="o"&gt;[&lt;/span&gt;localhost&lt;span class="o"&gt;]&lt;/span&gt;

    TASK: &lt;span class="o"&gt;[&lt;/span&gt;dummy &lt;span class="p"&gt;|&lt;/span&gt; create folder of the module name&lt;span class="o"&gt;]&lt;/span&gt; ****************************** 
    changed: &lt;span class="o"&gt;[&lt;/span&gt;localhost&lt;span class="o"&gt;]&lt;/span&gt;

    TASK: &lt;span class="o"&gt;[&lt;/span&gt;dummy &lt;span class="p"&gt;|&lt;/span&gt; create tests folder of the module name&lt;span class="o"&gt;]&lt;/span&gt; ************************ 
    changed: &lt;span class="o"&gt;[&lt;/span&gt;localhost&lt;span class="o"&gt;]&lt;/span&gt;

    TASK: &lt;span class="o"&gt;[&lt;/span&gt;dummy &lt;span class="p"&gt;|&lt;/span&gt; travis.yml&lt;span class="o"&gt;]&lt;/span&gt; **************************************************** 
    changed: &lt;span class="o"&gt;[&lt;/span&gt;localhost&lt;span class="o"&gt;]&lt;/span&gt;

    TASK: &lt;span class="o"&gt;[&lt;/span&gt;dummy &lt;span class="p"&gt;|&lt;/span&gt; gitignore&lt;span class="o"&gt;]&lt;/span&gt; ***************************************************** 
    changed: &lt;span class="o"&gt;[&lt;/span&gt;localhost&lt;span class="o"&gt;]&lt;/span&gt;

    TASK: &lt;span class="o"&gt;[&lt;/span&gt;dummy &lt;span class="p"&gt;|&lt;/span&gt; copy of th_dummy/__init__.py&lt;span class="o"&gt;]&lt;/span&gt; ********************************** 
    changed: &lt;span class="o"&gt;[&lt;/span&gt;localhost&lt;span class="o"&gt;]&lt;/span&gt;

    TASK: &lt;span class="o"&gt;[&lt;/span&gt;dummy &lt;span class="p"&gt;|&lt;/span&gt; copy of th_dummy/tests/__init__.py&lt;span class="o"&gt;]&lt;/span&gt; **************************** 
    changed: &lt;span class="o"&gt;[&lt;/span&gt;localhost&lt;span class="o"&gt;]&lt;/span&gt;

    TASK: &lt;span class="o"&gt;[&lt;/span&gt;dummy &lt;span class="p"&gt;|&lt;/span&gt; copy of LICENSE&lt;span class="o"&gt;]&lt;/span&gt; *********************************************** 
    changed: &lt;span class="o"&gt;[&lt;/span&gt;localhost&lt;span class="o"&gt;]&lt;/span&gt;

    TASK: &lt;span class="o"&gt;[&lt;/span&gt;dummy &lt;span class="p"&gt;|&lt;/span&gt; copy of MANIFEST.in&lt;span class="o"&gt;]&lt;/span&gt; ******************************************* 
    changed: &lt;span class="o"&gt;[&lt;/span&gt;localhost&lt;span class="o"&gt;]&lt;/span&gt;

    TASK: &lt;span class="o"&gt;[&lt;/span&gt;dummy &lt;span class="p"&gt;|&lt;/span&gt; copy of setup.py&lt;span class="o"&gt;]&lt;/span&gt; ********************************************** 
    changed: &lt;span class="o"&gt;[&lt;/span&gt;localhost&lt;span class="o"&gt;]&lt;/span&gt;

    TASK: &lt;span class="o"&gt;[&lt;/span&gt;dummy &lt;span class="p"&gt;|&lt;/span&gt; copy of README.rst&lt;span class="o"&gt;]&lt;/span&gt; ******************************************** 
    changed: &lt;span class="o"&gt;[&lt;/span&gt;localhost&lt;span class="o"&gt;]&lt;/span&gt;

    TASK: &lt;span class="o"&gt;[&lt;/span&gt;dummy &lt;span class="p"&gt;|&lt;/span&gt; copy of requirements.txt&lt;span class="o"&gt;]&lt;/span&gt; ************************************** 
    changed: &lt;span class="o"&gt;[&lt;/span&gt;localhost&lt;span class="o"&gt;]&lt;/span&gt;

    TASK: &lt;span class="o"&gt;[&lt;/span&gt;dummy &lt;span class="p"&gt;|&lt;/span&gt; copy of my_dummy.py to my_&lt;span class="o"&gt;{{&lt;/span&gt; module_name &lt;span class="o"&gt;}}&lt;/span&gt;.py&lt;span class="o"&gt;]&lt;/span&gt; *************** 
    changed: &lt;span class="o"&gt;[&lt;/span&gt;localhost&lt;span class="o"&gt;]&lt;/span&gt;

    TASK: &lt;span class="o"&gt;[&lt;/span&gt;dummy &lt;span class="p"&gt;|&lt;/span&gt; copy of model.py&lt;span class="o"&gt;]&lt;/span&gt; ********************************************** 
    changed: &lt;span class="o"&gt;[&lt;/span&gt;localhost&lt;span class="o"&gt;]&lt;/span&gt;

    TASK: &lt;span class="o"&gt;[&lt;/span&gt;dummy &lt;span class="p"&gt;|&lt;/span&gt; copy of forms.py&lt;span class="o"&gt;]&lt;/span&gt; ********************************************** 
    changed: &lt;span class="o"&gt;[&lt;/span&gt;localhost&lt;span class="o"&gt;]&lt;/span&gt;

    TASK: &lt;span class="o"&gt;[&lt;/span&gt;dummy &lt;span class="p"&gt;|&lt;/span&gt; copy of test.py&lt;span class="o"&gt;]&lt;/span&gt; *********************************************** 
    changed: &lt;span class="o"&gt;[&lt;/span&gt;localhost&lt;span class="o"&gt;]&lt;/span&gt;

    TASK: &lt;span class="o"&gt;[&lt;/span&gt;dummy &lt;span class="p"&gt;|&lt;/span&gt; copy of the templates&lt;span class="o"&gt;]&lt;/span&gt; ***************************************** 
    changed: &lt;span class="o"&gt;[&lt;/span&gt;localhost&lt;span class="o"&gt;]&lt;/span&gt;

    PLAY RECAP ******************************************************************** 
    localhost                  : &lt;span class="nv"&gt;ok&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;17&lt;/span&gt;   &lt;span class="nv"&gt;changed&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;16&lt;/span&gt;   &lt;span class="nv"&gt;unreachable&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;    &lt;span class="nv"&gt;failed&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;   

    &lt;span class="o"&gt;(&lt;/span&gt;triggerhappy-bootstrap&lt;span class="o"&gt;)&lt;/span&gt;foxmask@zorro:~/Django-VirtualEnv/django-th-ansible$ ls -ltR django-th-johndoe/
    django-th-johndoe/:
    total &lt;span class="m"&gt;24&lt;/span&gt;
    drwxr-xr-x &lt;span class="m"&gt;4&lt;/span&gt; foxmask foxmask &lt;span class="m"&gt;4096&lt;/span&gt; août  &lt;span class="m"&gt;23&lt;/span&gt; &lt;span class="m"&gt;16&lt;/span&gt;:28 th_johndoe
    -rw-r--r-- &lt;span class="m"&gt;1&lt;/span&gt; foxmask foxmask   &lt;span class="m"&gt;14&lt;/span&gt; août  &lt;span class="m"&gt;23&lt;/span&gt; &lt;span class="m"&gt;16&lt;/span&gt;:28 requirements.txt
    -rw-r--r-- &lt;span class="m"&gt;1&lt;/span&gt; foxmask foxmask &lt;span class="m"&gt;1368&lt;/span&gt; août  &lt;span class="m"&gt;23&lt;/span&gt; &lt;span class="m"&gt;16&lt;/span&gt;:28 README.rst
    -rw-r--r-- &lt;span class="m"&gt;1&lt;/span&gt; foxmask foxmask &lt;span class="m"&gt;1186&lt;/span&gt; août  &lt;span class="m"&gt;23&lt;/span&gt; &lt;span class="m"&gt;16&lt;/span&gt;:28 setup.py
    -rw-r--r-- &lt;span class="m"&gt;1&lt;/span&gt; foxmask foxmask  &lt;span class="m"&gt;194&lt;/span&gt; août  &lt;span class="m"&gt;23&lt;/span&gt; &lt;span class="m"&gt;16&lt;/span&gt;:28 MANIFEST.in
    -rw-r--r-- &lt;span class="m"&gt;1&lt;/span&gt; foxmask foxmask &lt;span class="m"&gt;1484&lt;/span&gt; août  &lt;span class="m"&gt;23&lt;/span&gt; &lt;span class="m"&gt;16&lt;/span&gt;:28 LICENSE

    django-th-johndoe/th_johndoe:
    total &lt;span class="m"&gt;28&lt;/span&gt;
    drwxr-xr-x &lt;span class="m"&gt;2&lt;/span&gt; foxmask foxmask &lt;span class="m"&gt;4096&lt;/span&gt; août  &lt;span class="m"&gt;23&lt;/span&gt; &lt;span class="m"&gt;16&lt;/span&gt;:28 tests
    -rw-r--r-- &lt;span class="m"&gt;1&lt;/span&gt; foxmask foxmask  &lt;span class="m"&gt;471&lt;/span&gt; août  &lt;span class="m"&gt;23&lt;/span&gt; &lt;span class="m"&gt;16&lt;/span&gt;:28 forms.py
    -rw-r--r-- &lt;span class="m"&gt;1&lt;/span&gt; foxmask foxmask  &lt;span class="m"&gt;614&lt;/span&gt; août  &lt;span class="m"&gt;23&lt;/span&gt; &lt;span class="m"&gt;16&lt;/span&gt;:28 models.py
    -rw-r--r-- &lt;span class="m"&gt;1&lt;/span&gt; foxmask foxmask &lt;span class="m"&gt;6424&lt;/span&gt; août  &lt;span class="m"&gt;23&lt;/span&gt; &lt;span class="m"&gt;16&lt;/span&gt;:28 my_johndoe.py
    -rw-r--r-- &lt;span class="m"&gt;1&lt;/span&gt; foxmask foxmask   &lt;span class="m"&gt;81&lt;/span&gt; août  &lt;span class="m"&gt;23&lt;/span&gt; &lt;span class="m"&gt;16&lt;/span&gt;:28 __init__.py
    drwxr-xr-x &lt;span class="m"&gt;3&lt;/span&gt; foxmask foxmask &lt;span class="m"&gt;4096&lt;/span&gt; août  &lt;span class="m"&gt;23&lt;/span&gt; &lt;span class="m"&gt;16&lt;/span&gt;:28 templates

    django-th-johndoe/th_johndoe/tests:
    total &lt;span class="m"&gt;4&lt;/span&gt;
    -rw-r--r-- &lt;span class="m"&gt;1&lt;/span&gt; foxmask foxmask &lt;span class="m"&gt;3725&lt;/span&gt; août  &lt;span class="m"&gt;23&lt;/span&gt; &lt;span class="m"&gt;16&lt;/span&gt;:28 test.py
    -rw-r--r-- &lt;span class="m"&gt;1&lt;/span&gt; foxmask foxmask    &lt;span class="m"&gt;0&lt;/span&gt; août  &lt;span class="m"&gt;23&lt;/span&gt; &lt;span class="m"&gt;16&lt;/span&gt;:28 __init__.py

    django-th-johndoe/th_johndoe/templates:
    total &lt;span class="m"&gt;4&lt;/span&gt;
    drwxr-xr-x &lt;span class="m"&gt;2&lt;/span&gt; foxmask foxmask &lt;span class="m"&gt;4096&lt;/span&gt; août  &lt;span class="m"&gt;23&lt;/span&gt; &lt;span class="m"&gt;16&lt;/span&gt;:28 th_johndoe

    django-th-johndoe/th_johndoe/templates/th_johndoe:
    total &lt;span class="m"&gt;20&lt;/span&gt;
    -rw-r--r-- &lt;span class="m"&gt;1&lt;/span&gt; foxmask foxmask &lt;span class="m"&gt;1277&lt;/span&gt; août  &lt;span class="m"&gt;23&lt;/span&gt; &lt;span class="m"&gt;16&lt;/span&gt;:28 edit_provider.html
    -rw-r--r-- &lt;span class="m"&gt;1&lt;/span&gt; foxmask foxmask &lt;span class="m"&gt;1277&lt;/span&gt; août  &lt;span class="m"&gt;23&lt;/span&gt; &lt;span class="m"&gt;16&lt;/span&gt;:28 edit_consumer.html
    -rw-r--r-- &lt;span class="m"&gt;1&lt;/span&gt; foxmask foxmask &lt;span class="m"&gt;1513&lt;/span&gt; août  &lt;span class="m"&gt;23&lt;/span&gt; &lt;span class="m"&gt;16&lt;/span&gt;:28 wz-3-form.html
    -rw-r--r-- &lt;span class="m"&gt;1&lt;/span&gt; foxmask foxmask &lt;span class="m"&gt;1513&lt;/span&gt; août  &lt;span class="m"&gt;23&lt;/span&gt; &lt;span class="m"&gt;16&lt;/span&gt;:28 wz-1-form.html
    -rw-r--r-- &lt;span class="m"&gt;1&lt;/span&gt; foxmask foxmask  &lt;span class="m"&gt;382&lt;/span&gt; août  &lt;span class="m"&gt;23&lt;/span&gt; &lt;span class="m"&gt;16&lt;/span&gt;:28 callback.html
&lt;/pre&gt;&lt;/div&gt;</content><category term="Techno"></category><category term="ansible"></category><category term="Django"></category><category term="python"></category><category term="TriggerHappy"></category></entry><entry><title>Ansible : les variables définies à la volée</title><link href="https://foxmask.net/post/2015/08/11/ansible-les-variables-definies-a-la-volee/" rel="alternate"></link><published>2015-08-11T10:45:00+02:00</published><updated>2015-08-11T10:45:00+02:00</updated><author><name>foxmask</name></author><id>tag:foxmask.net,2015-08-11:/post/2015/08/11/ansible-les-variables-definies-a-la-volee/</id><summary type="html">&lt;p&gt;&lt;strong&gt;Ansible : comment définir des variables à la volée dans son playbook&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Imaginons que j'ai besoin de définir des variables au fur et à mesure
que le processus avance&lt;/p&gt;
&lt;p&gt;Cas concret déployer des WAR issues d'une "nightly build" depuis des
repo maven :&lt;/p&gt;
&lt;p&gt;je demarre par une tâche allant à la pêche …&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;strong&gt;Ansible : comment définir des variables à la volée dans son playbook&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Imaginons que j'ai besoin de définir des variables au fur et à mesure
que le processus avance&lt;/p&gt;
&lt;p&gt;Cas concret déployer des WAR issues d'une "nightly build" depuis des
repo maven :&lt;/p&gt;
&lt;p&gt;je demarre par une tâche allant à la pêche aux SNAPSHOT&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Find last snapshot&lt;/span&gt;
  &lt;span class="nt"&gt;command&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ssh {{&lt;/span&gt;&lt;span class="err"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;server_repo }} ls -d {{ maven_repository&lt;/span&gt;&lt;span class="err"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;}}/standard/{{ branch }}.*-SNAPSHOT | sort&lt;/span&gt;
  &lt;span class="nt"&gt;register&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;snapshot&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ici &lt;em&gt;register&lt;/em&gt; va me permettre d'utiliser "snapshot" par la suite.
Disons &lt;em&gt;command&lt;/em&gt; m'a permit de trouver FOOBAR-1.2.3-SNAPSHOT&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;let&amp;#39;s define &amp;quot;war_path&amp;quot;&lt;/span&gt;
  &lt;span class="nt"&gt;command&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;echo {{ path }}{{ snapshot.stdout | basename }}.war&lt;/span&gt;
  &lt;span class="nt"&gt;when&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;snapshot&lt;/span&gt;
  &lt;span class="nt"&gt;register&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;war_path&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ici 2 choses et une astuce :&lt;/p&gt;
&lt;p&gt;1) j'utilise de nouveau &lt;em&gt;register&lt;/em&gt; pour pouvoir télécharger le war plus
tard
2) j'utilise &lt;em&gt;when&lt;/em&gt; ce qui permet de ne faire la &lt;em&gt;command&lt;/em&gt; que quand la
tasks &lt;strong&gt;&lt;em&gt;snapshot&lt;/em&gt;&lt;/strong&gt; est &lt;em&gt;register&lt;/em&gt;ed
3) l'astuce : utiliser &lt;em&gt;command&lt;/em&gt; comme si on avait fait un simple
export FOO=BAR, et sur la ligne de &lt;em&gt;command&lt;/em&gt; on utilise
&lt;em&gt;snapshot.stdout&lt;/em&gt; parce qu'on a &lt;em&gt;register&lt;/em&gt; &lt;em&gt;snapshot&lt;/em&gt; précédement qui
n'est qu'une chaine et pas une liste.
Ce qui, avec les filtres "basename" et la concaténation avec ".war ",
me donne grosso modo comme résultat un tout QQ :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  &lt;span class="nb"&gt;echo&lt;/span&gt; /un/jolie/path/FOOBAR-1.2.3-SNAPSHOT.war
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;tâche suivante :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;war_path download from server_repo&lt;/span&gt;
  &lt;span class="nt"&gt;command&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;scp -pr {{ server_repo }}:{{ war_path.stdout }} /temp&lt;/span&gt;
  &lt;span class="nt"&gt;when&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;war_path&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ici un simple scp, on remarquera &lt;em&gt;war_path&lt;/em&gt; qui est la tasks &lt;em&gt;register&lt;/em&gt;
juste au dessus et le &lt;em&gt;when&lt;/em&gt; qui utilise &lt;em&gt;war_path&lt;/em&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;war_path check is here&lt;/span&gt;
  &lt;span class="nt"&gt;stat&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;path=/temp/{{ war_path.stdout | basename}}&lt;/span&gt;
  &lt;span class="nt"&gt;register&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;war_path_exists&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ici vérification que le transfert a eu lieu&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;war_path fail to download&lt;/span&gt;
  &lt;span class="nt"&gt;fail&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;file /temp/{{ war_path.stdout | basename}} does not exists&lt;/span&gt;
  &lt;span class="nt"&gt;when&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;war_path_exists.stat.exists == False&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ici on peut vérifier que ça a foiré, on se contente d'un message
d'erreur mais on aurait pu faire péter un mail au service IT :P&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;war_path Extract&lt;/span&gt;
  &lt;span class="nt"&gt;command&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;chdir={{ home }}/{{ target }}-tomcat/webapps/{{ foobar }} {{ java_home }}/bin/jar xf /temp/{{ war_path.stdout | basename }}&lt;/span&gt;
  &lt;span class="nt"&gt;when&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;war_path&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;et on acheve par la décompression du war&lt;/p&gt;
&lt;p&gt;je vous fais grâce du restart tomcat :)&lt;/p&gt;
&lt;p&gt;Pour finir, &lt;a href="https://gist.github.com/foxmask/b3c958169933e044f7b0"&gt;un petit gist qui fait joujou avec uniquement des variables
à base de echo :)&lt;/a&gt;&lt;/p&gt;</content><category term="Techno"></category><category term="ansible"></category><category term="python"></category></entry></feed>