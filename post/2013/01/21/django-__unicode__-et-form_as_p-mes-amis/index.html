<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Django __unicode__ et form.as_p mes amis - Le Free de la Passion</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="https://foxmask.net/post/2013/01/21/django-__unicode__-et-form_as_p-mes-amis/">

        <meta name="author" content="foxmask" />
        <meta name="keywords" content="Django" />
        <meta name="description" content="Toujours dans mes périgrinations de débutant, voici un coup qui m&#39;a pris du temps à trouver seul, donc si ça peut servir à d&#39;autres ;) Donc voici, Chapitre Un __unicode__ je veux produire une page pour afficher un formulaire composé de 2 listes déroulantes issues d&#39;un autre modèle + un champ de …" />

        <meta property="og:site_name" content="Le Free de la Passion" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Django __unicode__ et form.as_p mes amis"/>
        <meta property="og:url" content="https://foxmask.net/post/2013/01/21/django-__unicode__-et-form_as_p-mes-amis/"/>
        <meta property="og:description" content="Toujours dans mes périgrinations de débutant, voici un coup qui m&#39;a pris du temps à trouver seul, donc si ça peut servir à d&#39;autres ;) Donc voici, Chapitre Un __unicode__ je veux produire une page pour afficher un formulaire composé de 2 listes déroulantes issues d&#39;un autre modèle + un champ de …"/>
        <meta property="article:published_time" content="2013-01-21" />
            <meta property="article:section" content="Techno" />
            <meta property="article:tag" content="Django" />
            <meta property="article:author" content="foxmask" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://foxmask.net/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="https://foxmask.net/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://foxmask.net/theme/css/pygments/native.css" rel="stylesheet">
    <link href="https://foxmask.net/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="https://foxmask.net/theme/css/style.css" type="text/css"/>

        <link href="https://foxmask.net/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Le Free de la Passion ATOM Feed"/>

        <link href="https://foxmask.net/feeds/all.rss.xml" type="application/rss+xml" rel="alternate"
              title="Le Free de la Passion RSS Feed"/>


        <link href="https://foxmask.net/feeds/techno.atom.xml" type="application/atom+xml" rel="alternate"
              title="Le Free de la Passion Techno ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://foxmask.net/" class="navbar-brand">
Le Free de la Passion            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="https://foxmask.net/pages/a-propos">
                             À propos
                          </a></li>
                        <li >
                            <a href="https://foxmask.net/category/entrevues.html">Entrevues</a>
                        </li>
                        <li >
                            <a href="https://foxmask.net/category/games.html">Games</a>
                        </li>
                        <li >
                            <a href="https://foxmask.net/category/general.html">General</a>
                        </li>
                        <li >
                            <a href="https://foxmask.net/category/news.html">News</a>
                        </li>
                        <li class="active">
                            <a href="https://foxmask.net/category/techno.html">Techno</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="https://foxmask.net/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://foxmask.net/post/2013/01/21/django-__unicode__-et-form_as_p-mes-amis/"
                       rel="bookmark"
                       title="Permalink to Django __unicode__ et form.as_p mes amis">
                        Django __unicode__ et form.as_p mes amis
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2013-01-21T10:00:00+01:00"> Mon 21 January 2013</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="https://foxmask.net/tag/django.html">Django</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Toujours dans mes périgrinations de débutant, voici un coup qui m'a pris
du temps à trouver seul, donc si ça peut servir à d'autres ;)</p>
<p>Donc voici,</p>
<p><strong>Chapitre Un __unicode__</strong></p>
<p>je veux produire une page pour afficher un formulaire composé de 2
listes déroulantes issues d'un autre modèle + un champ de texte</p>
<p>j'ai composé le modèle suivant :<br>
<strong>models.py</strong></p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TriggerType</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TriggerType</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">140</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TriggerService</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TriggerService</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">provider</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">TriggerType</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">consummer</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">TriggerType</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
    <span class="n">date_created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>
</pre></div>


<p>et voici mon formulaire<br>
<strong>forms.py</strong></p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TriggerServiceForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">ModelForm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Trigger Form</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            meta to add/override anything we need</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">TriggerService</span>
        <span class="n">widgets</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span>  
           <span class="n">TextInput</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;placeholder&#39;</span><span class="p">:</span>  
                            <span class="n">_</span><span class="p">(</span><span class="s1">&#39;A description for your new service&#39;</span><span class="p">)}),</span>
        <span class="p">}</span>

    <span class="n">provider</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelChoiceField</span><span class="p">(</span><span class="n">queryset</span><span class="o">=</span><span class="n">TriggerType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
    <span class="n">consummer</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ModelChoiceField</span><span class="p">(</span><span class="n">queryset</span><span class="o">=</span><span class="n">TriggerType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
</pre></div>


<p>Voilà !</p>
<p>A présent voici ce qui se passait quand j'affichais mon formulaire :</p>
<p>Dans mes 2 listes déroulantes j'obtenais "TriggerType object" en quise
de valeur dans ces 2 listes.<br>
Comme j'ai eu du mal à trouver la solution finale, dans un premier
temps je me suis résigné à faire un tuple dans mon form :</p>
<div class="highlight"><pre><span></span><span class="n">TRIGGER_TYPE</span> <span class="o">=</span> <span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">TriggerType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span>
<span class="n">provider</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ChoiceField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Provider&#39;</span><span class="p">),</span>
                         <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">Select</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">TRIGGER_TYPE</span><span class="p">,</span>
                         <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Select the service from which you want to grad your datas&#39;</span><span class="p">))</span>
<span class="n">consummer</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">ChoiceField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Consummer&#39;</span><span class="p">),</span>
                          <span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">Select</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">TRIGGER_TYPE</span><span class="p">,</span>
                          <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Select the service to which you want to put your datas&#39;</span><span class="p">))</span>
</pre></div>


<p>ca marchait très bien mais comme je suis borné et avait repéré
<a href="https://docs.djangoproject.com/en/dev/ref/forms/fields/#modelchoicefield">ModelChoiceField</a>
je me suis dit "nan mais ho ModelChoiceField prend bien en argument le
nom d'un modèle alors CA DOIT le faire!"</p>
<p>En retournant donc sur la doc j'entrevois la lumière :</p>
<blockquote>
<p>The __unicode__ method of the model will be called to generate
string representations of the objects for use in the field's choices;
to provide customized representations,</p>
</blockquote>
<p>Non de ieuD ! c'est aussi con que ça ?<br>
je retourne à mon modèle :<br>
<strong>models.py</strong></p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TriggerType</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TriggerType</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">140</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            required to build the drop down list</span>
<span class="sd">            otherwise will dislpay </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>


<p>et là de retour dans ma page web, Alélouya tout est tout propre.</p>
<p>Content de moi, cette fois ci je pars pour saisir mes données et les
enregistrer.</p>
<p><strong>Chapitre Deux form.as_p</strong><br>
Confiant je ponds un formulaire à la main avec la vue qui va bien et
avec le modèle ci dessus <em>TriggerService</em> et mon form
<em>TriggerServiceForm</em></p>
<p><strong>add_service.html</strong></p>
<div class="highlight"><pre><span></span>        <span class="p">{</span><span class="o">%</span> <span class="n">trans</span> <span class="s1">&#39;Creation of a new service&#39;</span> <span class="o">%</span><span class="p">}</span>

        <span class="p">{</span><span class="o">%</span> <span class="n">csrf_token</span> <span class="o">%</span><span class="p">}</span>

            <span class="p">{</span><span class="o">%</span> <span class="n">trans</span> <span class="s1">&#39;Provider&#39;</span> <span class="o">%</span><span class="p">}</span>

            <span class="p">{{</span> <span class="n">form</span><span class="o">.</span><span class="n">provider</span> <span class="p">}}</span>



            <span class="p">{</span><span class="o">%</span> <span class="n">trans</span> <span class="s1">&#39;Consummer&#39;</span> <span class="o">%</span><span class="p">}</span>

            <span class="p">{{</span> <span class="n">form</span><span class="o">.</span><span class="n">consummer</span> <span class="p">}}</span>



            <span class="p">{</span><span class="o">%</span> <span class="n">trans</span> <span class="s1">&#39;Description&#39;</span> <span class="o">%</span><span class="p">}</span>

            <span class="p">{{</span> <span class="n">form</span><span class="o">.</span><span class="n">description</span> <span class="p">}}</span>




            <span class="p">{</span><span class="o">%</span> <span class="n">trans</span> <span class="s2">&quot;Create it&quot;</span> <span class="o">%</span><span class="p">}</span>
</pre></div>


<p>et voici ma vue <strong>views.py</strong></p>
<div class="highlight"><pre><span></span><span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">save_service</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        save a service</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>  <span class="c1"># If the form has been submitted...</span>
        <span class="n">service</span> <span class="o">=</span> <span class="n">TriggerService</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">TriggerServiceForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">service</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>  <span class="c1"># All validation rules pass</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">&#39;/trigger_added/&#39;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># unbound form (if any)</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">TriggerServiceForm</span><span class="p">()</span>
    <span class="c1"># redirect to home of the existing enabled services</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">)</span>
</pre></div>


<p>Et là quand je soumets mon formulaire je repars d'où je viens, la page
d'accueil (ici "home") sans que rien n'ai été ajouté dans ma base.</p>
<p>Parti la fleur au fusil j'ai carrément été trop vite.<br>
Oui et le lecteur attentif dira "ben oui tu gères pas le cas où le
formulaire n'est pas valide du coup on n'a pas les raisons du pourquoi
ca passe pas"</p>
<p>Exact ! So Let's go :</p>
<div class="highlight"><pre><span></span><span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">save_service</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        save a service</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>  <span class="c1"># If the form has been submitted...</span>
        <span class="n">service</span> <span class="o">=</span> <span class="n">TriggerService</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">TriggerServiceForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="n">service</span><span class="p">)</span>
        <span class="c1"># 1) valid the form</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>  <span class="c1"># All validation rules pass</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="c1"># 2) redirect user</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">&#39;/trigger_added/&#39;</span><span class="p">)</span>
        <span class="c1"># 3) if not valid</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;add_service.html&#39;</span>
            <span class="c1"># 4) keep the data put in the form</span>
            <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span> <span class="p">}</span>
            <span class="n">context</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">csrf</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
            <span class="c1"># 5) go back to the form and display the values + errors</span>
            <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="n">template_name</span><span class="p">,</span>
                                      <span class="n">context</span><span class="p">,</span>
                                      <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    <span class="c1"># attempt to acces to save_service by another method than POST</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># unbound form (if any)</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">TriggerServiceForm</span><span class="p">()</span>
    <span class="c1"># redirect to home of the existing enabled services</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">)</span>
</pre></div>


<p>Là, ma vue m'a l'air cool mais encore une fois je me retrouve sur le
formulaire de saisie à tourner en boucle sans avoir les erreurs ...<br>
Après un peu de creusage de neuronne (oui j'en ai qu'un, surtout à
cette heure là :P) je farfouille dans les sources de django-registration
:D et retombe sur la propriété errors de chacun des champs.<br>
Je modifie tout ca et fini par produire le template suivant :<br>
<strong>add_service.html</strong></p>
<div class="highlight"><pre><span></span>        <span class="p">{</span><span class="o">%</span> <span class="n">trans</span> <span class="s1">&#39;Creation of a new service&#39;</span> <span class="o">%</span><span class="p">}</span>

        <span class="p">{</span><span class="o">%</span> <span class="n">csrf_token</span> <span class="o">%</span><span class="p">}</span>
        <span class="p">{{</span> <span class="n">form</span><span class="o">.</span><span class="n">non_field_errors</span> <span class="p">}}</span>

            <span class="p">{</span><span class="o">%</span> <span class="n">trans</span> <span class="s1">&#39;Provider&#39;</span> <span class="o">%</span><span class="p">}</span>

            <span class="p">{{</span> <span class="n">form</span><span class="o">.</span><span class="n">provider</span><span class="o">.</span><span class="n">errors</span> <span class="p">}}</span>
            <span class="p">{{</span> <span class="n">form</span><span class="o">.</span><span class="n">provider</span> <span class="p">}}</span>



            <span class="p">{</span><span class="o">%</span> <span class="n">trans</span> <span class="s1">&#39;Consummer&#39;</span> <span class="o">%</span><span class="p">}</span>

            <span class="p">{{</span> <span class="n">form</span><span class="o">.</span><span class="n">consummer</span><span class="o">.</span><span class="n">errors</span> <span class="p">}}</span>
            <span class="p">{{</span> <span class="n">form</span><span class="o">.</span><span class="n">consummer</span> <span class="p">}}</span>



            <span class="p">{</span><span class="o">%</span> <span class="n">trans</span> <span class="s1">&#39;Description&#39;</span> <span class="o">%</span><span class="p">}</span>

            <span class="p">{{</span> <span class="n">form</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">errors</span> <span class="p">}}</span>
            <span class="p">{{</span> <span class="n">form</span><span class="o">.</span><span class="n">description</span> <span class="p">}}</span>




            <span class="p">{</span><span class="o">%</span> <span class="n">trans</span> <span class="s2">&quot;Create it&quot;</span> <span class="o">%</span><span class="p">}</span>
</pre></div>


<p>Là tranquillement j'enregistre mon formulaire confiant (oui toujours ;)
mais déchante aussitôt !<br>
Je boucle toujours !!!</p>
<p>*Groumpf*</p>
<p><a href="https://docs.djangoproject.com/en/dev/topics/forms/#displaying-a-form-using-a-template" title="displaying a form using a template">Je retourne à la doc et je retrouve une
balise</a>
<strong>form.as_p</strong> qui permet d'afficher son formulaire sans rien faire
d'autre ;)<br>
je m'empresse de l'ajouter après <strong>{% csrf_token %}</strong> et recharge ma
page et là Ô surprise, je m'aperçois que j'ai oublié tout bêtement 2
éléments de mon modèle qui sont à présent dans mon formulaire qui sont :
user et date_create ce qui fait que mon form.is_valid() ne passait pas
une seule fois.</p>
<dl>
<dt>Donc j'ajoute à ma classe <strong>Meta</strong> de ma classe <strong>TriggerServiceForm</strong></dt>
<dd><strong>forms.py</strong></dd>
</dl>
<div class="highlight"><pre><span></span>        <span class="n">exclude</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;date_created&#39;</span><span class="p">)</span>
</pre></div>


<p>et une option à mon modèle pour ajouter une date automatiquement à
chaque enregistrement des données du modèle</p>
<p><strong>models.py</strong></p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TriggerService</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TriggerService</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="o">...</span>
   <span class="n">date_created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<p>et hop hop hop tout roule comme sur des roulettes.</p>
<p>C'est pas trop tôt !</p>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Related Posts:</h4>
    <ul>
        <li><a href="https://foxmask.net/post/2017/07/10/fabric-contrib-django/">Fabric, et la contrib django pour acceder à tous vos joujoux</a></li>
        <li><a href="https://foxmask.net/post/2016/09/08/revue-technique-de-la-semaine-du-05092016/">Revue Technique de la semaine du 05/09/2016</a></li>
        <li><a href="https://foxmask.net/post/2016/07/03/django-et-https/">Django et HTTPS</a></li>
        <li><a href="https://foxmask.net/post/2016/03/23/actionform-django-a-la-rescousse/">ActionForm Django à la rescousse !</a></li>
        <li><a href="https://foxmask.net/post/2016/02/15/trigger-happy-running-softly-with-rq/">Trigger Happy running softly with RQ</a></li>
    </ul>
</section>
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'foxmasktriggerhappyeu'; // required: replace example with your forum shortname

                    var disqus_identifier = 'django-__unicode__-et-form_as_p-mes-amis';
                var disqus_url = 'https://foxmask.net/post/2013/01/21/django-__unicode__-et-form_as_p-mes-amis/';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Tag Cloud -->
<li class="list-group-item">
  <a href="https://foxmask.net/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
  <ul class="list-group list-inline tagcloud" id="tags">
    <li class="list-group-item tag-4">
      <a href="https://foxmask.net/tag/ansible.html">ansible</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://foxmask.net/tag/apachemysqlphp.html">ApacheMySqlPHP</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://foxmask.net/tag/autobahn.html">autobahn</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://foxmask.net/tag/crossbar.html">crossbar</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://foxmask.net/tag/debian.html">debian</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://foxmask.net/tag/django.html">django</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://foxmask.net/tag/evernote.html">Evernote</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://foxmask.net/tag/fabric.html">Fabric</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://foxmask.net/tag/havefnubb.html">HaveFnuBB</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://foxmask.net/tag/jelix.html">Jelix</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://foxmask.net/tag/joplin.html">joplin</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://foxmask.net/tag/linux.html">linux</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://foxmask.net/tag/oracle.html">oracle</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://foxmask.net/tag/pelican.html">pelican</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://foxmask.net/tag/pycharm.html">PyCharm</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://foxmask.net/tag/python.html">python</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://foxmask.net/tag/pythonerie.html">pythonerie</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://foxmask.net/tag/triggerhappy.html">triggerhappy</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://foxmask.net/tag/wallabag.html">wallabag</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://foxmask.net/tag/wampws.html">wampws</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Tag Cloud -->

<!-- Sidebar/Github -->
<li class="list-group-item">
  <h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
  <div id="gh_repos">
    <p class="list-group-item">Status updating...</p>
  </div>
  <a href="https://github.com/foxmask">@foxmask</a> on GitHub
</li>
<!-- End Sidebar/Github -->

<!-- Sidebar/Links -->
<li class="list-group-item">
  <h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
  <ul class="list-group" id="links">
    <li class="list-group-item">
      <a href="http://sametmax.com" target="_blank">Sam et Max</a>
    </li>
    <li class="list-group-item">
      <a href="https://foxmask.net/feeds/all.rss.xml" target="_blank">RSS</a>
    </li>
    <li class="list-group-item">
      <a href="https://foxmask.net/feeds/all.atom.xml" target="_blank">Atom</a>
    </li>
    <li class="list-group-item">
      <a href="http://planetpython.org/" target="_blank">Python Planet</a>
    </li>
    <li class="list-group-item">
      <a href="http://django-planet.com/" target="_blank">Django Planet</a>
    </li>
    <li class="list-group-item">
      <a href="http://www.django-fr.org/planete/" target="_blank">Django-Fr Planet</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Links -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2018 FoxMaSk
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>              <p><small>Unless otherwise stated, all articles are published under the <a href="http://www.wtfpl.net/about/">WTFPL</a> license.</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://foxmask.net/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://foxmask.net/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://foxmask.net/theme/js/respond.min.js"></script>


    <script src="https://foxmask.net/theme/js/bodypadding.js"></script>

<!-- GitHub JS Code -->
<script type="text/javascript">
$(document).ready(function () {
  if (!window.jXHR) {
    var jxhr = document.createElement('script');
    jxhr.type = 'text/javascript';
    jxhr.src = 'https://foxmask.net/theme/js/jXHR.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(jxhr, s);
  }

  github.showRepos({
    user: 'foxmask',
    count: 5,
    skip_forks: false,
    target: '#gh_repos'
  });
});
</script>
<script src="https://foxmask.net/theme/js/github.js" type="text/javascript"></script>
<!-- End GitHub JS Code -->
    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'foxmasktriggerhappyeu'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->


</body>
</html>