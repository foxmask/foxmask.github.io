<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Relatorio et la Secret Release Story - Le Free de la Passion</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="https://www.foxmask.org/post/2013/08/29/relatorio-secret-release-story/">

        <meta name="author" content="foxmask" />
        <meta name="keywords" content="python,relatorio" />
        <meta name="description" content="Il y a 6 mois tout pile je testais relatorio avec succès sur un petit script pour un besoin précis et n&#39;avait plus le temps d&#39;approfondir le sujet pour le boulot. Les choses avançant (enfin), j&#39;ai pu finir de faire le script python qui me permet à présent de produire …" />

        <meta property="og:site_name" content="Le Free de la Passion" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Relatorio et la Secret Release Story"/>
        <meta property="og:url" content="https://www.foxmask.org/post/2013/08/29/relatorio-secret-release-story/"/>
        <meta property="og:description" content="Il y a 6 mois tout pile je testais relatorio avec succès sur un petit script pour un besoin précis et n&#39;avait plus le temps d&#39;approfondir le sujet pour le boulot. Les choses avançant (enfin), j&#39;ai pu finir de faire le script python qui me permet à présent de produire …"/>
        <meta property="article:published_time" content="2013-08-29" />
            <meta property="article:section" content="Techno" />
            <meta property="article:tag" content="python" />
            <meta property="article:tag" content="relatorio" />
            <meta property="article:author" content="foxmask" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://www.foxmask.org/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="https://www.foxmask.org/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://www.foxmask.org/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="https://www.foxmask.org/theme/css/style.css" type="text/css"/>

        <link href="https://www.foxmask.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Le Free de la Passion ATOM Feed"/>

        <link href="https://www.foxmask.org/feeds/all.rss.xml" type="application/rss+xml" rel="alternate"
              title="Le Free de la Passion RSS Feed"/>
        <link href="https://www.foxmask.org/feeds/techno.atom.xml" type="application/atom+xml" rel="alternate"
              title="Le Free de la Passion Techno ATOM Feed"/>
</head>
<body>

<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://www.foxmask.org/" class="navbar-brand">
Le Free de la Passion            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="https://www.foxmask.org/pages/a-propos">
                             À propos
                          </a></li>
                        <li >
                            <a href="https://www.foxmask.org/category/games.html">Games</a>
                        </li>
                        <li >
                            <a href="https://www.foxmask.org/category/general.html">General</a>
                        </li>
                        <li >
                            <a href="https://www.foxmask.org/category/korea.html">Korea</a>
                        </li>
                        <li >
                            <a href="https://www.foxmask.org/category/link.html">Link</a>
                        </li>
                        <li class="active">
                            <a href="https://www.foxmask.org/category/techno.html">Techno</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="https://www.foxmask.org/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<!-- Banner -->
<!-- End Banner -->

<!-- Content Container -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://www.foxmask.org/post/2013/08/29/relatorio-secret-release-story/"
                       rel="bookmark"
                       title="Permalink to Relatorio et la Secret Release Story">
                        Relatorio et la Secret Release Story
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2013-08-29T16:07:00+02:00"> jeu. 29 août 2013</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="https://www.foxmask.org/tag/python.html">python</a>
        /
	<a href="https://www.foxmask.org/tag/relatorio.html">relatorio</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Il y a 6 mois tout pile <a href="/post/2013/02/25/incontournables-pythonerie-oh-ho-ho-geant-vert/" title="Incontournables Pythonerie : Oh ho ho Géant Vert">je testais
relatorio</a>
avec succès sur un petit script pour un besoin précis et n'avait plus le
temps d'approfondir le sujet pour le boulot.</p>
<p>Les choses avançant (enfin), j'ai pu finir de faire le script python qui
me permet à présent de produire des documents openoffice automatiquement
à partir :</p>
<ul>
<li>d'un modèle openoffice (comme on en ferait un pour word en utilisant
    la "fusion &amp; publipostage" pour ceux à qui ça parle plus)</li>
<li>et d'une source de données au format XML provenant de
    <a href="http://buildprocess.sf.net" title="Autodeploy">Autodeploy</a>.</li>
</ul>
<p>Autodeploy servant à manager pas moins de 160 environnements jEE pour
les installations et mises à jour.</p>
<p>Une fois les release produites, installées et testées il faut les livrer
aux clients. Et qui trouve-t-on au bout de la chaine pour tout cela ?
ouais ouais vous avez compris :)</p>
<p>Pendant longtemps déjà je me coltinais la création des livraisons aux
clients à la mimine (avec un mkdir -p des dossiers requis + wget des 'n'
archives dans chaque folder, vous voyez le patacaisse) jusqu'au moment
où la quantité de livraisons à effectuer dépassait 1j/homme et ai fini
par produire <a href="https://github.com/foxmask/autodeploy-make-delivery">Make
delivery</a>, un
script python parcourant le fichier XML d'Autodeploy.<br>
Ce dernier en extrait les tarball avec le nom du package et les colle
dans une arborescence de folders définie avant de tout compresser pour
l'envoyer au client.<br>
Temps passé <strong>avant</strong> make delivery : <strong>1heure par livraison</strong><br>
Temps passé <strong>depuis</strong> make delivery : <strong>15min par livraison</strong> et je
suis large</p>
<p>Seulement dans le process de livraison, on fourni quand même une @#*!
de release note faite ... MAIN ! release note qu'on faisait vérifier par
le consultant afin de s'assurer que le contenu du document collait
parfaitement au livrable.<br>
Je vous laisse imaginer le temps perdu, les ratés potentiels, et la
suite chez le client qui installe tout le toutim.</p>
<p>A présent tout ça c'est FINI ! Bibi a fait l'(comic) script !</p>
<p>Le script "MakeDelivery" sera donc suivi par un second "MakeRelease"
pour la création de la doc, et aucune erreur de numéro de version ne
sera plus possible !</p>
<p>Grâce aux gars de la prod et du build process basé sur maven, on dispose
des numeros de version dans les urls de chaque package, d'où j'en
extrais le nom et la version que je refile dans un beau "dict()" lequel
"dict" est avalé par
<a href="http://code.google.com/p/python-relatorio/" title="Page du projet relatorio">relatorio</a>
qui pond le "document sésame" sans erreur possible !</p>
<p>Tout cela est tout beau mais attention quand même aux surprises de
dernières minutes. Comme je l'ai dit au début de ce billet j'avais
commencé mon script en février et mon</p>
<div class="highlight"><pre><span></span><code><span class="n">pip</span> <span class="n">install</span> <span class="n">relatorio</span> 
</code></pre></div>

<p>ne m'a pas chatouillé à l'époque.</p>
<p>Entre temps une release majeure debian est passée sur ma machine et
surtout une mise à jour relatorio !<br>
En reprenant donc le cours de mon installation je me refais un
virtualenv je lance sereinement le pip install précédent.</p>
<p>Une fois tout installé (enfin dirai-je) je fini mes devs sur mon script
make_release.py et me dit "bon ce coup ci tout est prêt pour produire
enfin un doc Ooo" et au premier lancement <em>zboing</em> la fin des haricots !</p>
<div class="highlight"><pre><span></span><code><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;run.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">172</span><span class="p">,</span> <span class="ow">in</span> 
    <span class="n">main</span><span class="p">()</span>
  <span class="n">File</span> <span class="s2">&quot;run.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">166</span><span class="p">,</span> <span class="ow">in</span> <span class="n">main</span>
    <span class="n">generate_doc</span><span class="p">(</span><span class="n">customer_release</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;run.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">130</span><span class="p">,</span> <span class="ow">in</span> <span class="n">generate_doc</span>
    <span class="n">basic</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="s1">&#39;Foo_bar.odt&#39;</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;[...]/lib/python2.7/dist-packages/relatorio/templates/opendocument.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">245</span><span class="p">,</span> <span class="ow">in</span> <span class="fm">__init__</span>
    <span class="n">encoding</span><span class="p">,</span> <span class="n">lookup</span><span class="p">,</span> <span class="n">allow_exec</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;[...]/lib/python2.7/dist-packages/genshi/template/markup.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">67</span><span class="p">,</span> <span class="ow">in</span> <span class="fm">__init__</span>
    <span class="n">allow_exec</span><span class="o">=</span><span class="n">allow_exec</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;[...]/lib/python2.7/dist-packages/genshi/template/base.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">417</span><span class="p">,</span> <span class="ow">in</span> <span class="fm">__init__</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
<span class="ne">TypeError</span><span class="p">:</span> <span class="n">expected</span> <span class="n">read</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">NoneType</span> <span class="n">found</span>
</code></pre></div>

<p>Un truc aurait dû me mettre la puce à l'oreille, la flopée de modules
python supplémentaires à compiler/installer, me dis-je, incriminant
d'emblée relatorio et sa v 0.6.0 puisque même les exemples fournis sur
le wiki ne passaient pas.</p>
<p>Comme je me farcie pas mal de problèmes revêches quotidiennement, je
procède avec dichotomie afin de trouver qui de relatorio ou de genshi me
casse <em>vraiment</em> les pieds. Je laisse la 0.6.0 de relatorio et supprime
genshi 0.7.0 et mets une 0.6.0 à la place en me disant si cela ne passe
pas, au pire, je me ferai un nouveau virtualenv tout neuf avec un
relatorio 0.5.0.</p>
<p>je relance mon script et là ! ô joie, plus d'erreur et ma release note
est là toute belle !<br>
Gain de temps final ? : je ne vous en parle même pas ! plus de besoin
de faire 'n' validations "humaines" inutiles ! plus besoin de lancer
OpenOffice pour produire le document. Tout va être scripté mon bon
môsieur !</p>
<p><strong>edit</strong>: la solution pour utiliser la dernière version de genshi est en
commentaire et tout rentre dans l'ordre ;)</p>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Related Posts:</h4>
    <ul>
        <li><a href="https://www.foxmask.org/post/2013/02/25/incontournables-pythonerie-oh-ho-ho-geant-vert/">Incontournables Pythonerie : Oh ho ho Géant Vert</a></li>
        <li><a href="https://www.foxmask.org/post/2022/05/27/boring-python-dependency-management-b-list/">Boring Python: dependency management - b-list</a></li>
        <li><a href="https://www.foxmask.org/post/2022/05/27/build-a-url-shortener-with-fastapi-and-python-real-python-realpython/">Build a URL Shortener With FastAPI and Python – Real Python - realpython</a></li>
        <li><a href="https://www.foxmask.org/post/2022/05/27/the-call-for-proposals-for-djangocon-us-2022-is-now-open-djangoproject/">The Call for Proposals for DjangoCon US 2022 Is Now Open! - djangoproject</a></li>
        <li><a href="https://www.foxmask.org/post/2022/05/27/how-to-publish-an-open-source-python-package-to-pypi-real-python-realpython/">How to Publish an Open-Source Python Package to PyPI – Real Python - realpython</a></li>
        <li><a href="https://www.foxmask.org/post/2022/05/27/welcome-to-hypothesis-hypothesis-6469-documentation-readthedocs/">Welcome to Hypothesis! — Hypothesis 6.46.9 documentation - readthedocs</a></li>
        <li><a href="https://www.foxmask.org/post/2022/03/17/copier-readthedocs/">copier - readthedocs</a></li>
        <li><a href="https://www.foxmask.org/post/2022/02/08/hacker-news-avec-django/">hacker news avec django</a></li>
    </ul>
</section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Links -->
<li class="list-group-item">
  <h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
  <ul class="list-group" id="links">
    <li class="list-group-item">
      <a href="/feeds/all.rss.xml" target="_blank">FoxMaSk RSS</a>
    </li>
    <li class="list-group-item">
      <a href="https://python.org/" target="_blank">Python</a>
    </li>
    <li class="list-group-item">
      <a href="https://pycon.fr/" target="_blank">PyConFr</a>
    </li>
    <li class="list-group-item">
      <a href="https://pycon.kr/" target="_blank">PyConKr</a>
    </li>
    <li class="list-group-item">
      <a href="https://www.djangoproject.com/" target="_blank">Django</a>
    </li>
    <li class="list-group-item">
      <a href="https://www.django-rest-framework.org/" target="_blank">DRF</a>
    </li>
    <li class="list-group-item">
      <a href="https://www.ansible.com/" target="_blank">Ansible</a>
    </li>
    <li class="list-group-item">
      <a href="https://www.coree-culture.org/?lang=fr" target="_blank">Centre Culturel Coréen</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Links -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<!-- End Content Container -->

<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2023 FoxMaSk
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>              <p><small>Unless otherwise stated, all articles are published under the <a href="http://www.wtfpl.net/about/">WTFPL</a> license.</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://www.foxmask.org/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://www.foxmask.org/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://www.foxmask.org/theme/js/respond.min.js"></script>


    <script src="https://www.foxmask.org/theme/js/bodypadding.js"></script>


</body>
</html>