<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Quête WampWS et Autobahn - épisode 1 - Le Free de la Passion</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="https://foxmask.net/post/2015/02/27/quete-wampws-et-autobahn-episode-1/">

        <meta name="author" content="foxmask" />
        <meta name="keywords" content="autobahn,crossbar,python,TriggerHappy,wampws" />
        <meta name="description" content="Une contré fort fort lointaine L&#39;était une fois ... des druides, des gueux, des recettes magiques et un gentilhomme En chemin pour une contré fort fort lointaine, un gentilhomme (qu&#39;on appellera DaveLooper), passa par maintes tribulations et turpitudes tantôt armé de son lance pierres Perl, tantôt de son arbalète PHP, tantôt …" />

        <meta property="og:site_name" content="Le Free de la Passion" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Quête WampWS et Autobahn - épisode 1"/>
        <meta property="og:url" content="https://foxmask.net/post/2015/02/27/quete-wampws-et-autobahn-episode-1/"/>
        <meta property="og:description" content="Une contré fort fort lointaine L&#39;était une fois ... des druides, des gueux, des recettes magiques et un gentilhomme En chemin pour une contré fort fort lointaine, un gentilhomme (qu&#39;on appellera DaveLooper), passa par maintes tribulations et turpitudes tantôt armé de son lance pierres Perl, tantôt de son arbalète PHP, tantôt …"/>
        <meta property="article:published_time" content="2015-02-27" />
            <meta property="article:section" content="Techno" />
            <meta property="article:tag" content="autobahn" />
            <meta property="article:tag" content="crossbar" />
            <meta property="article:tag" content="python" />
            <meta property="article:tag" content="TriggerHappy" />
            <meta property="article:tag" content="wampws" />
            <meta property="article:author" content="foxmask" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://foxmask.net/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="https://foxmask.net/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://foxmask.net/theme/css/pygments/native.css" rel="stylesheet">
    <link href="https://foxmask.net/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="https://foxmask.net/theme/css/style.css" type="text/css"/>

        <link href="https://foxmask.net/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Le Free de la Passion ATOM Feed"/>

        <link href="https://foxmask.net/feeds/all.rss.xml" type="application/rss+xml" rel="alternate"
              title="Le Free de la Passion RSS Feed"/>


        <link href="https://foxmask.net/feeds/{slug}.atom.xml" type="application/atom+xml" rel="alternate"
              title="Le Free de la Passion Techno ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://foxmask.net/" class="navbar-brand">
Le Free de la Passion            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="https://foxmask.net/pages/a-propos">
                             À propos
                          </a></li>
                        <li >
                            <a href="https://foxmask.net/category/entrevues.html">Entrevues</a>
                        </li>
                        <li >
                            <a href="https://foxmask.net/category/games.html">Games</a>
                        </li>
                        <li >
                            <a href="https://foxmask.net/category/general.html">General</a>
                        </li>
                        <li >
                            <a href="https://foxmask.net/category/news.html">News</a>
                        </li>
                        <li class="active">
                            <a href="https://foxmask.net/category/techno.html">Techno</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="https://foxmask.net/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://foxmask.net/post/2015/02/27/quete-wampws-et-autobahn-episode-1/"
                       rel="bookmark"
                       title="Permalink to Quête WampWS et Autobahn - épisode 1">
                        Quête  WampWS et Autobahn - épisode 1
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2015-02-27T14:45:00+01:00"> ven. 27 février 2015</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="https://foxmask.net/tag/autobahn.html">autobahn</a>
        /
	<a href="https://foxmask.net/tag/crossbar.html">crossbar</a>
        /
	<a href="https://foxmask.net/tag/python.html">python</a>
        /
	<a href="https://foxmask.net/tag/triggerhappy.html">TriggerHappy</a>
        /
	<a href="https://foxmask.net/tag/wampws.html">wampws</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p><strong>Une contré fort fort lointaine</strong></p>
<p><em>L'était une fois ... des druides, des gueux, des recettes magiques et
un gentilhomme</em></p>
<p>En chemin pour une contré fort fort lointaine, un gentilhomme (qu'on
appellera <em>DaveLooper</em>), passa par maintes tribulations et turpitudes
tantôt armé de son <strong>lance pierres Perl</strong>, tantôt de son <strong>arbalète
PHP</strong>, tantôt de son <strong>épée Python</strong>.</p>
<p>Il se fraya un chemin à travers bois parce que les grands routes n'avait
guère grâce à ses yeux.</p>
<p>C'est ainsi que grâce à son épée, il parvint à se tailler des outils,
tel TriggerHappy, un tireur toujours content, né à partir d'une
partition entonnée par un troubadour nommé Django, qui lui servirent à
se forger de nouvelles armes plus ou moins affûtées.</p>
<p>La dernière arme en date fut
<a href="http://wamp.ws/" title="Web Application Protocol Messaging">WampWS</a> un projet
foufoufou, qui fait rêver à l'arme absolue.<br>
Si vous voulez découvrir, en langage profane, ce qu'un gueux peut
attendre de ce projet, <a href="http://sametmax.com/presentation-de-wamp-round-2/">ruez vous chez sam et
max</a></p>
<p>Comme <em>DaveLooper</em> n'en est même pas à se forger le pommeau de cette
dernière, il est loin de l'extase, mais il aime ripailler, et partager,
du coup, il s'en va vous narrer comment il a déjà pu débuter ce morceau.</p>
<p>Le socle de base de cette nouvelle arme est encore TriggerHappy.</p>
<p>Il reste fidèle à son outil fétiche. - Il s'en va l'améliorer.</p>
<p>L'idée est donc de reprendre le MCD existant, et de bâtir autour, une
arme qui utiliserait le maillage de côte de
<a href="http://crossbar.io/" title="Unified Application Router">crossbar</a>/<a href="http://wamp.ws/" title="Web Application Protocol Messaging">WampWS</a>
via <a href="http://autobahn.ws/">autobahn</a>.</p>
<p>Pour ce faire <em>DaveLooper</em> a beaucoup échange de pigeons voyageur avec
le druide détenant la recette de wampws, et ce dernier lui fourni les
jarres qu'il jugeât les plus à même de remplir l'office.</p>
<p>Ces derniers sont :<br>
Polymer + autobahnJS \&lt;=> crossbar => autobahnjs + twisted +
txpostgres => postgresql.</p>
<p>Le choix évoqué par l'érudit se justifie par la scalabilité.</p>
<p>Ça fait un paquet de jattes à connaitre avant d'arriver à un résultat
honorable diriez vous à <em>DaveLooper</em>.</p>
<p>mais tout de même :</p>
<ul>
<li>Crossbar s'installe aisément, reste à creuser la doc pour obtenir
    une configuration digne de nom.</li>
<li>Polymer+Autobahn sera l'étape suivante pour voir comment ça se
    goupille en récupérant les données de la base et en les affichant
    avec Polymer</li>
<li>Autobahn+twisted+txpostgres : c'est cet ensemble que <em>DaveLooper</em>
    s'en va vous décrire.</li>
</ul>
<p>Il a préféré tâter le back-end avant le front au cas où le back-end
aurait été un désastre, le front aurait été oublié.</p>
<p>Donc, le principe est le suivant avec cette stack : crossbar oriente les
requêtes entre des composants applicatifs, et ceux ci se parlent en
temps réel et de façon asynchrone</p>
<p>En 2 lignes voilà crossbar prêt</p>
<div class="highlight"><pre><span></span><code>crossbar init
</code></pre></div>


<p>à ne faire que la première fois que vous installez crossbar</p>
<div class="highlight"><pre><span></span><code>crossbar start
</code></pre></div>


<p>pour chaque lancement de l'outil</p>
<p>Une fois fait, on peut à son tour démarrer les composants qui trépignent
à se faire des causeries.</p>
<p><a href="https://github.com/tavendo/AutobahnPython/blob/master/examples/twisted/wamp/basic/pubsub/basic/frontend.py">On en lance
un</a>
:</p>
<div class="highlight"><pre><span></span><code>python frontend.py
session attached
Got event: <span class="m">0</span>
Got event: <span class="m">1</span>
Got event: <span class="m">2</span>
Got event: <span class="m">3</span>
Got event: <span class="m">4</span>
Got event: <span class="m">5</span>
disconnected
</code></pre></div>


<p><a href="https://github.com/tavendo/AutobahnPython/blob/master/examples/twisted/wamp/basic/pubsub/basic/backend.py">puis
2</a>
:</p>
<div class="highlight"><pre><span></span><code>python backend.py
session attached
.
.
.
.
.
.
.
.
.
.
.
</code></pre></div>


<p>et hoooo ça se cause vindiou.</p>
<p>Simple efficace. What else ?<br>
Ben on se le demande ? allez on se le demande :D</p>
<p>Pour partir sur du plus concret et proche de ce que <em>DaveLooper</em> a mis
en branle avec l'heureux tireur "TriggerHappy", il se dit</p>
<blockquote>
<p>bien, quand le projet a démarré, seul Evernote causait avec des flux
RSS. Repartons donc sur ces traces 'pour voir' ce que ces jarres
recommandés par le druide peuvent réaliser</p>
</blockquote>
<p>Le pattern utilisé sera donc publisher/subscriber. Où Evernote sera le
composant subscriber du composant RSS, le publisher.</p>
<p>Déroulement :</p>
<p>Pour obtenir les items des flux RSS, on récupère de la table qui les
contient d'abord les URL de ces flux, puis on parcourt les flux
eux-mêmes, et pour chaque item on "publish" le contenu de l'article au
subscriber.</p>
<p>Quand les données parviennent au composant subscriber, il n'a plus qu'à
les enregistrer.</p>
<p>On va donc voir ci dessous tout cette machinerie, puis <a href="http://crossbar.io/docs/Database-Programming-with-PostgreSQL/">comment on
requête une base postgresql de façon
asynchrone</a>.</p>
<p><strong>le backend, the RSS Component</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">arrow</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">components.lib.feedsservice</span> <span class="kn">import</span> <span class="n">Feeds</span>
<span class="kn">from</span> <span class="nn">txpostgres</span> <span class="kn">import</span> <span class="n">txpostgres</span>
<span class="kn">from</span> <span class="nn">twisted.internet.defer</span> <span class="kn">import</span> <span class="n">inlineCallbacks</span><span class="p">,</span> <span class="n">returnValue</span>

<span class="kn">from</span> <span class="nn">autobahn</span> <span class="kn">import</span> <span class="n">wamp</span>

<span class="kn">from</span> <span class="nn">twisted.python</span> <span class="kn">import</span> <span class="n">log</span>
<span class="kn">from</span> <span class="nn">autobahn.twisted.util</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">autobahn.twisted.wamp</span> <span class="kn">import</span> <span class="n">ApplicationSession</span>


<span class="k">class</span> <span class="nc">RssComponent</span><span class="p">(</span><span class="n">ApplicationSession</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An application component that publishes an event</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@inlineCallbacks</span>
    <span class="k">def</span> <span class="nf">onJoin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">details</span><span class="p">):</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;session attached&quot;</span><span class="p">)</span>

        <span class="n">pool</span> <span class="o">=</span> <span class="n">txpostgres</span><span class="o">.</span><span class="n">ConnectionPool</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span>
                                         <span class="n">port</span><span class="o">=</span><span class="mi">5432</span><span class="p">,</span>
                                         <span class="n">database</span><span class="o">=</span><span class="s1">&#39;th&#39;</span><span class="p">,</span>
                                         <span class="n">user</span><span class="o">=</span><span class="s1">&#39;th&#39;</span><span class="p">,</span>
                                         <span class="n">password</span><span class="o">=</span><span class="s1">&#39;th&#39;</span><span class="p">)</span>

        <span class="k">yield</span> <span class="n">pool</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DB Connection pool started&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">pool</span>

        <span class="c1"># register all procedures on this class which have been</span>
        <span class="c1"># decorated to register them for remoting</span>
        <span class="n">regs</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;registered </span><span class="si">{}</span><span class="s1"> procedures&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">regs</span><span class="p">)))</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">feeds</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;eu.trigger-happy.rss.feeds_url&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">feeds</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;publishing </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;eu.trigger-happy.rss&#39;</span><span class="p">,</span>
                                 <span class="p">{</span><span class="s1">&#39;trigger_id&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;trigger_id&#39;</span><span class="p">],</span> <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">],</span><span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">})</span>
            <span class="k">yield</span> <span class="n">sleep</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>

    <span class="nd">@wamp</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;eu.trigger-happy.rss.feeds_url&#39;</span><span class="p">)</span>
    <span class="nd">@inlineCallbacks</span>
    <span class="k">def</span> <span class="nf">get_feeds_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            get the URL stored in the database</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT date_triggered, name, url, trigger_id, user_id FROM &quot;</span>
        <span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot;django_th_rss AS R, &quot;</span>
        <span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot;django_th_triggerservice AS TS &quot;</span>
        <span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot; WHERE R.trigger_id=TS.id &quot;</span>
        <span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot; AND TS.status = True &quot;</span>  <span class="c1">#  get only the activated triggers</span>
        <span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot; ORDER BY TS.date_triggered DESC &quot;</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">runQuery</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">feeds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;get the feeds url...&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">feed</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;get feeds from </span><span class="si">{0}</span><span class="s1"> =&gt; </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feed</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">feed</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">feed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_now</span><span class="p">():</span>
                <span class="n">feeds</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;trigger_id&#39;</span><span class="p">:</span> <span class="n">feed</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">feed</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                          <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">Feeds</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;url_to_parse&#39;</span><span class="p">:</span> <span class="n">feed</span><span class="p">[</span><span class="mi">2</span><span class="p">]})</span><span class="o">.</span><span class="n">datas</span><span class="p">()})</span>
        <span class="n">returnValue</span><span class="p">(</span><span class="n">feeds</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">right_now</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            TODO import settings from a file or smth to get the TZ details</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">arrow</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;Europe/Paris&#39;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">log</span><span class="o">.</span><span class="n">startLogging</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">autobahn.twisted.wamp</span> <span class="kn">import</span> <span class="n">ApplicationRunner</span>
    <span class="n">runner</span> <span class="o">=</span> <span class="n">ApplicationRunner</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;ws://127.0.0.1:8080/ws&quot;</span><span class="p">,</span> <span class="n">realm</span><span class="o">=</span><span class="s2">&quot;realm1&quot;</span><span class="p">)</span>
    <span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">RssComponent</span><span class="p">)</span>
</code></pre></div>


<p><strong>le frontend - the Evernote Component</strong></p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>

<span class="kn">import</span> <span class="nn">arrow</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="c1"># evernote API</span>

<span class="kn">from</span> <span class="nn">evernote.api.client</span> <span class="kn">import</span> <span class="n">EvernoteClient</span>
<span class="kn">from</span> <span class="nn">evernote.edam.notestore</span> <span class="kn">import</span> <span class="n">NoteStore</span>
<span class="kn">import</span> <span class="nn">evernote.edam.type.ttypes</span> <span class="k">as</span> <span class="nn">Types</span>
<span class="kn">from</span> <span class="nn">evernote.edam.error.ttypes</span> <span class="kn">import</span> <span class="n">EDAMUserException</span>

<span class="c1"># postgresql driver</span>
<span class="kn">from</span> <span class="nn">txpostgres</span> <span class="kn">import</span> <span class="n">txpostgres</span>

<span class="c1"># autobahn</span>
<span class="kn">from</span> <span class="nn">autobahn</span> <span class="kn">import</span> <span class="n">wamp</span>
<span class="kn">from</span> <span class="nn">twisted.python</span> <span class="kn">import</span> <span class="n">log</span>
<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">reactor</span>
<span class="kn">from</span> <span class="nn">twisted.internet.defer</span> <span class="kn">import</span> <span class="n">inlineCallbacks</span><span class="p">,</span> <span class="n">returnValue</span>

<span class="kn">from</span> <span class="nn">autobahn.twisted.wamp</span> <span class="kn">import</span> <span class="n">ApplicationSession</span>

<span class="kn">from</span> <span class="nn">sanitize</span> <span class="kn">import</span> <span class="n">sanitize</span>


<span class="k">class</span> <span class="nc">EvernoteComponent</span><span class="p">(</span><span class="n">ApplicationSession</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An application component that subscribes and receives events</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@inlineCallbacks</span>
    <span class="k">def</span> <span class="nf">onJoin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">details</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;session attached&quot;</span><span class="p">)</span>
        <span class="n">pool</span> <span class="o">=</span> <span class="n">txpostgres</span><span class="o">.</span><span class="n">ConnectionPool</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span>
                                         <span class="n">port</span><span class="o">=</span><span class="mi">5432</span><span class="p">,</span>
                                         <span class="n">database</span><span class="o">=</span><span class="s1">&#39;th&#39;</span><span class="p">,</span>
                                         <span class="n">user</span><span class="o">=</span><span class="s1">&#39;th&#39;</span><span class="p">,</span>
                                         <span class="n">password</span><span class="o">=</span><span class="s1">&#39;th&#39;</span><span class="p">)</span>

        <span class="k">yield</span> <span class="n">pool</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DB Connection pool started&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">pool</span>

        <span class="c1"># register all procedures on this class which have been</span>
        <span class="c1"># decorated to register them for remoting</span>
        <span class="n">regs</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;registered </span><span class="si">{}</span><span class="s1"> procedures&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">regs</span><span class="p">)))</span>

        <span class="nd">@inlineCallbacks</span>
        <span class="k">def</span> <span class="nf">on_event</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="nb">print</span> <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;eu.trigger-happy.evernote.save&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">on_event</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;eu.trigger-happy.rss&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;subscribe topic&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;could not subscribe to topic: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="c1">#yield self.subscribe(on_event, u&#39;eu.trigger-happy.pocket&#39;)</span>
        <span class="c1">#yield self.subscribe(on_event, u&#39;eu.trigger-happy.twitter&#39;)</span>


    <span class="k">def</span> <span class="nf">onDisconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;disconnected&quot;</span><span class="p">)</span>
        <span class="n">reactor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

    <span class="nd">@wamp</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;eu.trigger-happy.evernote.token&#39;</span><span class="p">)</span>
    <span class="nd">@inlineCallbacks</span>
    <span class="k">def</span> <span class="nf">get_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the token of the user that owns the trigger</span>
<span class="sd">        need to link the table with django_th_triggerservice to get the user id</span>
<span class="sd">        :param user_id:</span>
<span class="sd">        :return: a generator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT token FROM django_th_userservice &quot;</span>
        <span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot; WHERE name_id=&#39;ServiceEvernote&#39; &quot;</span>
        <span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot; AND user_id=</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">runQuery</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="n">token</span> <span class="o">=</span> <span class="n">row</span>
        <span class="n">returnValue</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>

    <span class="nd">@wamp</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;eu.trigger-happy.evernote.trigger&#39;</span><span class="p">)</span>
    <span class="nd">@inlineCallbacks</span>
    <span class="k">def</span> <span class="nf">get_trigger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trigger_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            get information for the current trigger</span>
<span class="sd">            such as notebook, tag, description</span>

<span class="sd">        :param trigger_id:</span>
<span class="sd">        :return: a generator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT notebook, tag, TS.description FROM django_th_evernote AS E, &quot;</span>
        <span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot; django_th_triggerservice AS TS &quot;</span>
        <span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot; WHERE E.trigger_id=TS.id  &quot;</span>
        <span class="n">query</span> <span class="o">+=</span> <span class="s2">&quot; AND trigger_id=&#39;</span><span class="si">{0}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">trigger_id</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">runQuery</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">notebook</span><span class="p">,</span><span class="n">tag</span><span class="p">,</span><span class="n">description</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">notebook</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;notebook&#39;</span><span class="p">:</span> <span class="n">notebook</span><span class="p">,</span> <span class="s1">&#39;tag&#39;</span><span class="p">:</span> <span class="n">tag</span><span class="p">,</span> <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">description</span><span class="p">}</span>
        <span class="n">returnValue</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="nd">@wamp</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;eu.trigger-happy.evernote.save&#39;</span><span class="p">)</span>
    <span class="nd">@inlineCallbacks</span>
    <span class="k">def</span> <span class="nf">save_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stuff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            save the data coming from the subscribed service</span>
<span class="sd">        :param stuff: contain a table of : user_id, trigger_id, item (the main content)</span>
<span class="sd">        :return: nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">stuff</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span>
        <span class="n">trigger_id</span> <span class="o">=</span> <span class="n">stuff</span><span class="p">[</span><span class="s1">&#39;trigger_id&#39;</span><span class="p">]</span>
        <span class="n">token</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;eu.trigger-happy.evernote.token&#39;</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">token</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">content</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">stuff</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    .... ici .... </span>
<span class="sd">    le long traitement pour exploiter les data et les envoyer sur son compte evernote</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">log</span><span class="o">.</span><span class="n">startLogging</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">autobahn.twisted.wamp</span> <span class="kn">import</span> <span class="n">ApplicationRunner</span>
    <span class="n">runner</span> <span class="o">=</span> <span class="n">ApplicationRunner</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;ws://127.0.0.1:8080/ws&quot;</span><span class="p">,</span><span class="n">realm</span><span class="o">=</span><span class="s2">&quot;realm1&quot;</span><span class="p">)</span>
    <span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">EvernoteComponent</span><span class="p">)</span>
</code></pre></div>


<p>Donc on lance le subscriber puis le publisher et quand le RssComponent
trouve des éléments à publier il les envoie directement au
EvernoteComponent<br>
Tout cela se lit dans les consoles respectives instantanément.</p>
<p>Voici pour le coté "bout de code concret qui marche"</p>
<p><strong>Écueils</strong> :<br>
Comme à chaque fois qu'on débute avec de nouveaux outils, on se tape
sur les doigts en se ratant/pensant enfoncer le clou.</p>
<p>Écueil 1 : erreur 111, la fameuse erreur 111...</p>
<div class="highlight"><pre><span></span><code>$ python frontend.py 
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">&quot;frontend.py&quot;</span>, line <span class="m">62</span>, in 
    runner.run<span class="o">(</span>Component<span class="o">)</span>
  File <span class="s2">&quot;...ocal/lib/python2.7/site-packages/autobahn/twisted/wamp.py&quot;</span>, line <span class="m">199</span>, in run
    raise connect_error.exception
twisted.internet.error.ConnectionRefusedError: Connection was refused by other side: <span class="m">111</span>: Connection refused.
</code></pre></div>


<p>ca veut dire que le composant ne parvient pas à contacter ... crossbar
...<br>
Ouais ouais ouais crossbar.<br>
Comme DaveLooper avait déjà vu cette erreur par le passé en des temps
reculés, il se dit comme à l'époque, "bon la base est pas joignable"<br>
Mais à tord</p>
<p>Donc 2 choses à checker : le port ouvert par crossbar dans
.crossbar/config.json</p>
<div class="highlight"><pre><span></span><code>        <span class="s2">&quot;transports&quot;</span><span class="err">:</span> <span class="p">[</span>
            <span class="p">{</span>
               <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;web&quot;</span><span class="p">,</span>
               <span class="nt">&quot;endpoint&quot;</span><span class="p">:</span> <span class="p">{</span>
                  <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;tcp&quot;</span><span class="p">,</span>
                  <span class="nt">&quot;port&quot;</span><span class="p">:</span> <span class="mi">8090</span>
               <span class="p">},</span>
               <span class="nt">&quot;paths&quot;</span><span class="p">:</span> <span class="p">{</span>
                  <span class="nt">&quot;/&quot;</span><span class="p">:</span> <span class="p">{</span>
                     <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;static&quot;</span><span class="p">,</span>
                     <span class="nt">&quot;directory&quot;</span><span class="p">:</span> <span class="s2">&quot;..&quot;</span>
                  <span class="p">},</span>
                  <span class="nt">&quot;ws&quot;</span><span class="p">:</span> <span class="p">{</span>
                     <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;websocket&quot;</span>
                  <span class="p">}</span>
               <span class="p">}</span>
            <span class="p">}</span>
         <span class="p">]</span>
</code></pre></div>


<p>et celui qu'on a défini dans le script :</p>
<div class="highlight"><pre><span></span><code>    <span class="n">runner</span> <span class="o">=</span> <span class="n">ApplicationRunner</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;ws://127.0.0.1:8090/ws&quot;</span><span class="p">,</span><span class="o">...</span><span class="p">)</span>
</code></pre></div>


<p>s'ils sont identiques, alors crossbar n'est pas démarré</p>
<p>Écueil 2 : debug<br>
Il est trop trop souvent arrivé à <em>DaveLooper</em> de voir ses petites
cailloux, les print, retraçant le cheminement de l'enchainement des
étapes ... S'arrêter sans rien dire du tout.<br>
Aussi est il allé se rendre dans quelques échoppes quérir de l'aide sur
sans en trouver...</p>
<p>Et comme Sam pourrait encore le dire en rigolant :</p>
<blockquote>
<p>chaque fois que <em>DaveLooper</em> pose une question, il fini par trouver la
réponse de lui même</p>
</blockquote>
<p>Ba oui <em>DaveLooper</em> est borné et cherche toujours jusqu'à la solution
quand les réponses se font rares.</p>
<p>Donc il a fini par trouver ceci :</p>
<div class="highlight"><pre><span></span><code>    <span class="n">runner</span> <span class="o">=</span> <span class="n">ApplicationRunner</span><span class="p">(</span>
                        <span class="n">url</span><span class="o">=</span><span class="s2">&quot;ws://127.0.0.1:8090/ws&quot;</span><span class="p">,</span>
                        <span class="n">realm</span><span class="o">=</span><span class="s2">&quot;realm1&quot;</span><span class="p">,</span>
                        <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="c1"># low-level WebSocket debugging</span>
                        <span class="n">debug_wamp</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># WAMP protocol-level debugging</span>
                        <span class="n">debug_app</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># app-level debugging</span>
</code></pre></div>


<p>Je vous dispenserai les logs, ils sont s'y verbeux qu'on croirait qu'on
compile le kernel linux ;)</p>
<p>Du coup quand les print s'arrêtent <em>DaveLooper</em> est content de savoir
enfin pourquoi.</p>
<p>Écueil 3 : leS elf ;)</p>
<p>Quand utiliser ces 4 là et comment.</p>
<div class="highlight"><pre><span></span><code><span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscriber</span><span class="p">()</span>
<span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">publish</span><span class="p">()</span>
</code></pre></div>


<p>De ce que <em>DaveLooper</em> a pu tester, les 2 premiers yield sont assez
explicites d'eux même.</p>
<div class="highlight"><pre><span></span><code><span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">()</span>
</code></pre></div>


<p>Par contre pour savoir quand faire self.call ou sel.method c'est une
autre histoire.<br>
Le self.call coté publisher aura permis de récupérer les données pour
le subscriber<br>
Cote subscriber self.call ne convient pas pour sauvegarder les données.
Pourquoi ?<br>
Parce qu'il fallait "décorer" la methode déclenchée lors du subscribe,
ici on_event()<br>
et donc rajouter yield devant.</p>
<p>Sinon, si on n'a pas besoin d'appels RPC, on utilisera self.method()</p>
<p><em>DaveLooper</em>, n'utilisant ces jarres que depuis samedi dernier, a eu mal
à comprendre tout ça sans <a href="http://indexerror.net/860/wamp-self-call-vs-self-publish-subscribe-vs-self-method">des explications fournies sur
indexerror</a></p>
<p><strong>To be continued</strong><br>
Nous voici donc arrivé au terme de ce petit voyage, de <em>DaveLooper</em>
toujours en quête de nouveauté, où en même temps, très peu et beaucoup
de choses ont été abordées.</p>
<p>Dans les prochains épisodes, DaveLooper a en tête quelques sujets comme
:</p>
<ul>
<li>démarrer un projet de zéro proprement, ou tout du moins prêt à
    l'emploi</li>
<li>la configuration de crossbar, pour alléger le code ci dessus et
    retirer les appels fait en dur à une base donnée par exemple</li>
<li>le "mode debug" de crossbar/wamp</li>
<li>wamplet</li>
</ul>
<p>nota : si vous avez réperé des coquille(tte)s dans le code, faites en
part en commentaire, comme ca fait que 5jours que <em>DaveLooper</em> utilise
le tout Crossbar/wamp/autobahn, il y a forcement beaucoup à améliorer,
et ca sera fait avec les prochains billets ;)</p>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Related Posts:</h4>
    <ul>
        <li><a href="https://foxmask.net/post/2015/05/12/quete-wampws-et-autobahn-episode-3-crossbar-config/">Quête WampWS et Autobahn - Episode 3 - Crossbar config</a></li>
        <li><a href="https://foxmask.net/post/2015/05/07/quete-wampws-et-autobahn-episode-2-demarrage-en-trombe/">Quête WampWS et Autobahn : Épisode 2 - démarrage en trombe</a></li>
        <li><a href="https://foxmask.net/post/2017/02/09/orotangi/">Orotangi, your thoughts everywhere</a></li>
        <li><a href="https://foxmask.net/post/2016/06/01/trigger-happy-apparition-subliminale-phptour-2016-wallabag/">Apparition subliminiale de TriggerHappy au PHPTour 2016 avec Wallabag</a></li>
        <li><a href="https://foxmask.net/post/2016/05/14/le-gros-nounours-noir-et-blanc-est-passe/">Panda, Le gros nounours noir et blanc est passé</a></li>
        <li><a href="https://foxmask.net/post/2016/04/22/wallabag-api-1.0.1/">Wallabag API 1.0.1</a></li>
        <li><a href="https://foxmask.net/post/2015/08/24/shoot-an-arrow-with-ansible-in-the-triggerhappy-target/">Shoot an Arrow with Ansible in the TriggerHappy target</a></li>
        <li><a href="https://foxmask.net/post/2015/08/18/django-trigger-happy-0-11-0-english-version/">Django Trigger Happy 0.11.0 English Version</a></li>
    </ul>
</section>
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'foxmasktriggerhappyeu'; // required: replace example with your forum shortname

                    var disqus_identifier = 'quete-wampws-et-autobahn-episode-1';
                var disqus_url = 'https://foxmask.net/post/2015/02/27/quete-wampws-et-autobahn-episode-1/';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Tag Cloud -->
<li class="list-group-item">
  <a href="https://foxmask.net/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
  <ul class="list-group list-inline tagcloud" id="tags">
    <li class="list-group-item tag-3">
      <a href="https://foxmask.net/tag/ansible.html">ansible</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://foxmask.net/tag/apachemysqlphp.html">ApacheMySqlPHP</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://foxmask.net/tag/autobahn.html">autobahn</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://foxmask.net/tag/crossbar.html">crossbar</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://foxmask.net/tag/debian.html">debian</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://foxmask.net/tag/django.html">Django</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://foxmask.net/tag/evernote.html">Evernote</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://foxmask.net/tag/fabric.html">Fabric</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://foxmask.net/tag/havefnubb.html">HaveFnuBB</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://foxmask.net/tag/jelix.html">Jelix</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://foxmask.net/tag/linux.html">linux</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://foxmask.net/tag/oracle.html">oracle</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://foxmask.net/tag/pelican.html">pelican</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://foxmask.net/tag/pycharm.html">PyCharm</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://foxmask.net/tag/python.html">Python</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://foxmask.net/tag/pythonerie.html">pythonerie</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://foxmask.net/tag/starlette.html">Starlette</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://foxmask.net/tag/triggerhappy.html">triggerhappy</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://foxmask.net/tag/wallabag.html">wallabag</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://foxmask.net/tag/wampws.html">wampws</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Tag Cloud -->

<!-- Sidebar/Github -->
<li class="list-group-item">
  <h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
  <div id="gh_repos">
    <p class="list-group-item">Status updating...</p>
  </div>
  <a href="https://github.com/foxmask">@foxmask</a> on GitHub
</li>
<!-- End Sidebar/Github -->

<!-- Sidebar/Links -->
<li class="list-group-item">
  <h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
  <ul class="list-group" id="links">
    <li class="list-group-item">
      <a href="https://foxmask.net/feeds/all.rss.xml" target="_blank">RSS</a>
    </li>
    <li class="list-group-item">
      <a href="https://foxmask.net/feeds/all.atom.xml" target="_blank">Atom</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Links -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2020 FoxMaSk
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>              <p><small>Unless otherwise stated, all articles are published under the <a href="http://www.wtfpl.net/about/">WTFPL</a> license.</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://foxmask.net/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://foxmask.net/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://foxmask.net/theme/js/respond.min.js"></script>


    <script src="https://foxmask.net/theme/js/bodypadding.js"></script>

<!-- GitHub JS Code -->
<script type="text/javascript">
$(document).ready(function () {
  if (!window.jXHR) {
    var jxhr = document.createElement('script');
    jxhr.type = 'text/javascript';
    jxhr.src = 'https://foxmask.net/theme/js/jXHR.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(jxhr, s);
  }

  github.showRepos({
    user: 'foxmask',
    count: 5,
    skip_forks: false,
    target: '#gh_repos'
  });
});
</script>
<script src="https://foxmask.net/theme/js/github.js" type="text/javascript"></script>
<!-- End GitHub JS Code -->
    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'foxmasktriggerhappyeu'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->


</body>
</html>