<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Django et HTTPS - Le Free de la Passion</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="https://blog.foxmask.org/post/2016/07/03/django-et-https/">

        <meta name="author" content="foxmask" />
        <meta name="keywords" content="Django,HTTPS" />
        <meta name="description" content="Un rapide billet pour poser ici un retour de prise de tête :) Avec la venue de LetsEncrypt, il va fleurer bon les sites en HTTPS de ci de là. Par contre une fois mis en place en prod, coté dev il arrive qu&#39;on fasse un hack vite fait pour pas …" />

        <meta property="og:site_name" content="Le Free de la Passion" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Django et HTTPS"/>
        <meta property="og:url" content="https://blog.foxmask.org/post/2016/07/03/django-et-https/"/>
        <meta property="og:description" content="Un rapide billet pour poser ici un retour de prise de tête :) Avec la venue de LetsEncrypt, il va fleurer bon les sites en HTTPS de ci de là. Par contre une fois mis en place en prod, coté dev il arrive qu&#39;on fasse un hack vite fait pour pas …"/>
        <meta property="article:published_time" content="2016-07-03" />
            <meta property="article:section" content="Techno" />
            <meta property="article:tag" content="Django" />
            <meta property="article:tag" content="HTTPS" />
            <meta property="article:author" content="foxmask" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://blog.foxmask.org/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="https://blog.foxmask.org/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://blog.foxmask.org/theme/css/pygments/native.css" rel="stylesheet">
    <link href="https://blog.foxmask.org/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="https://blog.foxmask.org/theme/css/style.css" type="text/css"/>

        <link href="https://blog.foxmask.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Le Free de la Passion ATOM Feed"/>

        <link href="https://blog.foxmask.org/feeds/all.rss.xml" type="application/rss+xml" rel="alternate"
              title="Le Free de la Passion RSS Feed"/>


        <link href="https://blog.foxmask.org/feeds/{slug}.atom.xml" type="application/atom+xml" rel="alternate"
              title="Le Free de la Passion Techno ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://blog.foxmask.org/" class="navbar-brand">
Le Free de la Passion            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="https://blog.foxmask.org/pages/a-propos">
                             À propos
                          </a></li>
                        <li >
                            <a href="https://blog.foxmask.org/category/entrevues.html">Entrevues</a>
                        </li>
                        <li >
                            <a href="https://blog.foxmask.org/category/games.html">Games</a>
                        </li>
                        <li >
                            <a href="https://blog.foxmask.org/category/general.html">General</a>
                        </li>
                        <li >
                            <a href="https://blog.foxmask.org/category/news.html">News</a>
                        </li>
                        <li class="active">
                            <a href="https://blog.foxmask.org/category/techno.html">Techno</a>
                        </li>
                        <li >
                            <a href="https://blog.foxmask.org/category/web.html">Web</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="https://blog.foxmask.org/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://blog.foxmask.org/post/2016/07/03/django-et-https/"
                       rel="bookmark"
                       title="Permalink to Django et HTTPS">
                        Django et HTTPS
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2016-07-03T22:00:00+02:00"> dim. 03 juillet 2016</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="https://blog.foxmask.org/tag/django.html">Django</a>
        /
	<a href="https://blog.foxmask.org/tag/https.html">HTTPS</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Un rapide billet pour poser ici un retour de prise de tête :)</p>
<p>Avec la venue de <a href="https://letsencrypt.org/">LetsEncrypt</a>, il va fleurer bon les sites en HTTPS de ci de là.</p>
<p>Par contre une fois mis en place en prod, coté dev il arrive qu'on fasse un hack vite fait pour pas passer 3 plombes sur sa conf nginx comme ça :</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">HTTPS</span><span class="o">=</span>on
./manage.py runserver
</code></pre></div>


<p>et roule ma poule !</p>
<p>Bon en prod par contre on ne va pas s'amuser à ca quand on a un NGINX en frontal du Gunicorn par exemple.</p>
<p>Et si on laisse en etat, au final tout accès à request.scheme vous retournera dans les dents un casse-burette 'http'.</p>
<p>Donc en suivant <a href="https://docs.djangoproject.com/en/1.9/ref/settings/#std:setting-SECURE_PROXY_SSL_HEADER">la doc</a> on modifie son settings en rajoutant </p>
<div class="highlight"><pre><span></span><code><span class="n">SECURE_PROXY_SSL_HEADER</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;HTTP_X_FORWARDED_PROTO&#39;</span><span class="p">,</span> <span class="s1">&#39;https&#39;</span><span class="p">)</span>
</code></pre></div>


<p>mais ça ne suffit toujours pas. Nginx renverra encore et toujours du HTTP...</p>
<p>donc à sa conf toute QQ </p>
<div class="highlight"><pre><span></span><code><span class="na">location / {</span>
        <span class="na">add_header           Front-End-Https    on;</span>
        <span class="na">add_header Cache-Control &quot;public, must-revalidate&quot;;</span>
        <span class="na">add_header Strict-Transport-Security &quot;max-age</span><span class="o">=</span><span class="s">2592000; includeSubdomains&quot;;</span>
<span class="s">        proxy_pass http://127.0.0.1:8080; # Pass to Gunicorn</span>
<span class="s">        proxy_next_upstream error timeout invalid_header;</span>
<span class="s">        proxy_set_header        Host            $host;</span>
<span class="s">        proxy_set_header        X-Real-IP       $remote_addr;</span>
<span class="s">        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span>
<span class="s">        proxy_set_header        X-Forwarded-Host $host;</span>
<span class="s">    }</span>
</code></pre></div>


<p>on rajoutera </p>
<div class="highlight"><pre><span></span><code><span class="na">proxy_set_header        X-Forwarded-Proto $scheme;</span>
</code></pre></div>


<p>pour obtenir : </p>
<div class="highlight"><pre><span></span><code><span class="na">location / {</span>
        <span class="na">add_header           Front-End-Https    on;</span>
        <span class="na">add_header Cache-Control &quot;public, must-revalidate&quot;;</span>
        <span class="na">add_header Strict-Transport-Security &quot;max-age</span><span class="o">=</span><span class="s">2592000; includeSubdomains&quot;;</span>
<span class="s">        proxy_pass http://127.0.0.1:8080; # Pass to Gunicorn</span>
<span class="s">        proxy_next_upstream error timeout invalid_header;</span>
<span class="s">        proxy_set_header        Host            $host;</span>
<span class="s">        proxy_set_header        X-Real-IP       $remote_addr;</span>
<span class="s">        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span>
<span class="s">        proxy_set_header        X-Forwarded-Host $host;</span>
<span class="s">        proxy_set_header        X-Forwarded-Proto $scheme;</span>
<span class="s">    }</span>
</code></pre></div>


<p>Et là au joie, on obtiendra bien un request.scheme vallant 'https'.</p>
            </div>
            <!-- /.entry-content -->
<section class="well" id="related-posts">
    <h4>Related Posts:</h4>
    <ul>
        <li><a href="https://blog.foxmask.org/post/2021/07/28/monit-and-more/">Monit ... and more</a></li>
        <li><a href="https://blog.foxmask.org/post/2020/09/08/nyuseu-news/">뉴스 - Nyuseu - News</a></li>
        <li><a href="https://blog.foxmask.org/post/2020/05/01/trigger-happy-archive-yeoboseyo/">Trigger Happy archivé - Yeoboseyo !</a></li>
        <li><a href="https://blog.foxmask.org/post/2019/05/02/de-django-a-starlette/">De django à starlette</a></li>
        <li><a href="https://blog.foxmask.org/post/2017/07/10/fabric-contrib-django/">Fabric, et la contrib django pour acceder à tous vos joujoux</a></li>
        <li><a href="https://blog.foxmask.org/post/2016/09/08/revue-technique-de-la-semaine-du-05092016/">Revue Technique de la semaine du 05/09/2016</a></li>
        <li><a href="https://blog.foxmask.org/post/2016/03/23/actionform-django-a-la-rescousse/">ActionForm Django à la rescousse !</a></li>
        <li><a href="https://blog.foxmask.org/post/2016/02/15/trigger-happy-running-softly-with-rq/">Trigger Happy running softly with RQ</a></li>
    </ul>
</section>
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'foxmasktriggerhappyeu'; // required: replace example with your forum shortname

                    var disqus_identifier = 'django-et-https';
                var disqus_url = 'https://blog.foxmask.org/post/2016/07/03/django-et-https/';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Tag Cloud -->
<li class="list-group-item">
  <a href="https://blog.foxmask.org/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
  <ul class="list-group list-inline tagcloud" id="tags">
    <li class="list-group-item tag-3">
      <a href="https://blog.foxmask.org/tag/ansible.html">ansible</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://blog.foxmask.org/tag/apachemysqlphp.html">ApacheMySqlPHP</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://blog.foxmask.org/tag/autobahn.html">autobahn</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://blog.foxmask.org/tag/crossbar.html">crossbar</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://blog.foxmask.org/tag/debian.html">debian</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://blog.foxmask.org/tag/django.html">django</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://blog.foxmask.org/tag/evernote.html">Evernote</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://blog.foxmask.org/tag/fabric.html">Fabric</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://blog.foxmask.org/tag/havefnubb.html">HaveFnuBB</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://blog.foxmask.org/tag/jelix.html">Jelix</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://blog.foxmask.org/tag/linux.html">linux</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://blog.foxmask.org/tag/oracle.html">oracle</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://blog.foxmask.org/tag/pelican.html">pelican</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://blog.foxmask.org/tag/pycharm.html">PyCharm</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://blog.foxmask.org/tag/python.html">python</a>
    </li>
    <li class="list-group-item tag-2">
      <a href="https://blog.foxmask.org/tag/pythonerie.html">pythonerie</a>
    </li>
    <li class="list-group-item tag-4">
      <a href="https://blog.foxmask.org/tag/starlette.html">Starlette</a>
    </li>
    <li class="list-group-item tag-1">
      <a href="https://blog.foxmask.org/tag/triggerhappy.html">triggerhappy</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://blog.foxmask.org/tag/wallabag.html">wallabag</a>
    </li>
    <li class="list-group-item tag-3">
      <a href="https://blog.foxmask.org/tag/wampws.html">wampws</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Tag Cloud -->

<!-- Sidebar/Links -->
<li class="list-group-item">
  <h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
  <ul class="list-group" id="links">
    <li class="list-group-item">
      <a href="/feeds/all.rss.xml" target="_blank">RSS</a>
    </li>
    <li class="list-group-item">
      <a href="/feeds/all.atom.xml" target="_blank">Atom</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Links -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2021 FoxMaSk
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>              <p><small>Unless otherwise stated, all articles are published under the <a href="http://www.wtfpl.net/about/">WTFPL</a> license.</small></p>
         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://blog.foxmask.org/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://blog.foxmask.org/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://blog.foxmask.org/theme/js/respond.min.js"></script>


    <script src="https://blog.foxmask.org/theme/js/bodypadding.js"></script>
    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'foxmasktriggerhappyeu'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->


</body>
</html>